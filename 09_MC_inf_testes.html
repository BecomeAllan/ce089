<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Fernando P. Mayer" />


<title>Métodos de Monte Carlo em inferência estatística</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66454501-13"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-66454501-13');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="default" type="text/css" />
<link rel="stylesheet" href="config/sydney-site.css" type="text/css" />
<link rel="stylesheet" href="config/sydney-site-fonts.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CE089</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="aulas.html">Aulas</a>
</li>
<li>
  <a href="referencias.html">Referências</a>
</li>
<li>
  <a href="materiais.html">Materiais</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leg-ufpr/ce089">
    <span class="fab fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Métodos de Monte Carlo em inferência estatística</h1>
<h3 class="subtitle">Testes de hipótese de Monte Carlo</h3>
<h4 class="author">Fernando P. Mayer</h4>

</div>


<div id="introdução" class="section level1">
<h1><span class="header-section-number">1</span> Introdução</h1>
<pre class="r"><code>fortunes::fortune(264)</code></pre>
<pre><code># 
# Soham: How to compute the p-value of a statistic generally?
# Berton Gunter: runif(1)
#    -- Soham and Berton Gunter
#       R-help (May 2010)</code></pre>
<p><span class="citation">Besag and Clifford (1989)</span> definiram que um teste de Monte Carlo generalizado é um que possui as seguintes características:</p>
<ol style="list-style-type: decimal">
<li>Um conjunto de dados observado, é apenas um entre muitos conjuntos que poderiam ter ocorrido</li>
<li>Todos os possíveis conjuntos de dados podem ser gerados a partir de uma série de mudanças incrementais nos dados (<strong>randomização</strong>)
<ul>
<li>Aqui vamos assumir que todos os possíveis conjuntos de dados podem ser gerados a partir de algum modelo probabilístico (Monte Carlo)</li>
</ul></li>
<li>A hipótese nula de interesse afirma que todos os possíveis conjuntos de dados possuem a mesma probabilidade de ocorrência</li>
<li>Todo conjunto de dados possível pode ser resumido por alguma estatística de teste <span class="math inline">\(S\)</span></li>
</ol>
<ul>
<li>Um teste de hipótese consiste em calcular uma medida (<strong>estatística de teste</strong>) e verificar o quanto ela é provável dentro do cenário de ocorrências puramente ao acaso, <strong>supondo que a hipótese nula é verdadeira</strong>.
<ul>
<li>Se a conclusão for de que é um valor dos mais prováveis, então não existem evidências para rejeitar a hipótese nula.</li>
<li>Se for dos resultados mais extremos, então existem evidências de que a hipótese nula não é verdadeira</li>
</ul></li>
</ul>
<p>Partindo dessa ideia, um teste de hipótese de Monte Carlo pode ser formulado da seguinte maneira:</p>
<ol style="list-style-type: decimal">
<li>Calcule a estatística de teste para a amostra</li>
<li>Supondo que a hipótese nula é verdadeira, simule valores com as mesmas características do modelo probabilístico sendo testado (sob <span class="math inline">\(H_0\)</span>)</li>
<li>Repita o passo (2) um número <span class="math inline">\(N\)</span> grande de vezes, e calcule a estatística de teste em todos os passos</li>
<li>Com a distribuição dos <span class="math inline">\(N\)</span> valores da estatística de teste (supondo <span class="math inline">\(H_0\)</span>) verdadeira, <strong>calcule a proporção de valores iguais ou mais extremos</strong> que a estatística de teste da amostra</li>
</ol>
<ul>
<li>O último passo pode ser interpretado como o <span class="math inline">\(p\)</span>-valor de Monte Carlo, ou <span class="math inline">\(p\)</span>-valor empírico.
<ul>
<li>Proporções altas mostram que a estatística de teste amostral não é tão extrema, o que favorece <span class="math inline">\(H_0\)</span></li>
<li>Proporções baixas indicam que a estatística de teste é extrema (pouca probabilidade de ocorrer simplesmente ao acaso), por isso a hipótese nula deve ser pouco plausível</li>
</ul></li>
</ul>
</div>
<div id="procedimento-padrão" class="section level1">
<h1><span class="header-section-number">2</span> Procedimento padrão</h1>
<div id="procedimentos-gerais-para-um-teste-de-hipótese" class="section level4 unnumbered">
<h4>Procedimentos gerais para um teste de hipótese</h4>
<ol style="list-style-type: decimal">
<li>Definir a hipótese nula (<span class="math inline">\(H_0\)</span>) e a alternativa (<span class="math inline">\(H_a\)</span>).</li>
<li>Definir um nível de significância <span class="math inline">\(\alpha\)</span>, que irá determinar o nível de confiança <span class="math inline">\(100(1 - \alpha)\)</span>% do teste.</li>
<li>Definir o tipo de teste, com base na hipótese alternativa.</li>
<li>Calcular a estatística de teste, com base na distribuição amostral do estimador do parâmetro sob teste <span class="math inline">\(\rightarrow\)</span> valor calculado.</li>
<li>Determinar a região crítica (região de rejeição), com base no nível. de significância <span class="math inline">\(\alpha\)</span> <span class="math inline">\(\rightarrow\)</span> valor crítico.</li>
<li>Concluir o teste.</li>
</ol>
</div>
<div id="erros-de-decisão" class="section level4 unnumbered">
<h4>Erros de decisão</h4>
<p>Para entendermos o que é o nível de significância <span class="math inline">\((\alpha)\)</span>, precisamos saber que, ao realizar um teste de hipótese, estamos sujeitos a dois tipos de erros.</p>
<ul>
<li><strong>Erro Tipo I</strong>: rejeitar <span class="math inline">\(H_0\)</span>, quando <span class="math inline">\(H_0\)</span> é verdadeira (falso negativo).</li>
<li><strong>Erro Tipo II</strong>: não rejeitar <span class="math inline">\(H_0\)</span>, quando <span class="math inline">\(H_0\)</span> é falsa (falso positivo).</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center"><span class="math inline">\(H_0\)</span> verdadeira</th>
<th align="center"><span class="math inline">\(H_0\)</span> falsa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Não rejeitar <span class="math inline">\(H_0\)</span></td>
<td align="center">Decisão correta</td>
<td align="center">Erro tipo II</td>
</tr>
<tr class="even">
<td align="left">Rejeitar <span class="math inline">\(H_0\)</span></td>
<td align="center">Erro tipo I</td>
<td align="center">Decisão correta</td>
</tr>
</tbody>
</table>
<p>Definimos por <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span> as probabilidades de cometer os erros do tipo I e II:</p>
<ul>
<li><span class="math inline">\(\alpha = \text{P}(\text{erro tipo I}) = \text{P}(\text{rejeitar } H_0 \, | \, H_0 \text{ verdadeira})\)</span>.</li>
<li><span class="math inline">\(\beta = \text{P}(\text{erro tipo II}) = \text{P}(\text{não rejeitar } H_0 \, | \, H_0 \text{ falsa})\)</span>.
<ul>
<li><span class="math inline">\(\alpha\)</span> é o <strong>nível de significância</strong> do teste.</li>
<li><span class="math inline">\(1 - \alpha\)</span> é o <strong>nível de confiança</strong> do teste.</li>
</ul></li>
</ul>
</div>
<div id="nível-descritivo" class="section level4 unnumbered">
<h4>Nível descritivo</h4>
<ul>
<li>Em geral, <span class="math inline">\(\alpha\)</span> é pré-fixado para construir a regra de decisão.</li>
<li>Uma alternativa é deixar em aberto a escolha de <span class="math inline">\(\alpha\)</span> para quem for tomar a decisão.</li>
<li>A ideia é calcular, <strong>supondo que a hipótese nula é verdadeira</strong>, a probabilidade de se obter estimativas <strong>iguais ou mais extremas do que aquela fornecida pela amostra</strong>.</li>
<li>Essa probabilidade é chamada de <strong>nível descritivo</strong>, denotada por <span class="math inline">\(\alpha^*\)</span> (ou <span class="math inline">\(p\)</span>-valor).</li>
<li>Valores pequenos de <span class="math inline">\(\alpha^*\)</span> evidenciam que a hipótese nula é falsa.</li>
<li>O conceito de “pequeno” fica para quem decide qual <span class="math inline">\(\alpha\)</span> deve usar para comparar com <span class="math inline">\(\alpha^*\)</span>.</li>
</ul>
<p>Para <strong>testes unilaterais</strong>, sendo <span class="math inline">\(H_0: \mu = \mu_0\)</span>, a expressão de <span class="math inline">\(\alpha^*\)</span> depende da hipótese alternativa:</p>
<p><span class="math display">\[\begin{align*}
\alpha^* &amp;= P(\bar{X} &lt; \bar{x}_{obs} \, | \, H_0 \text{ verdadeira}) \quad
\text{para } H_a: \mu &lt; \mu_0 \\
\alpha^* &amp;= P(\bar{X} &gt; \bar{x}_{obs} \, | \, H_0 \text{ verdadeira}) \quad
\text{para } H_a: \mu &gt; \mu_0
\end{align*}\]</span></p>
<p>Para <strong>testes bilaterais</strong>, temos <span class="math inline">\(H_0: \mu = \mu_0\)</span> contra <span class="math inline">\(H_0: \mu \neq \mu_0\)</span>, a definição do nível descritivo depende da relação entre <span class="math inline">\(\bar{x}_{obs}\)</span> e <span class="math inline">\(\mu_0\)</span>:</p>
<p><span class="math display">\[\begin{align*}
\alpha^* &amp;= 2 \times P(\bar{X} &lt; \bar{x}_{obs} \, | \, H_0 \text{
verdadeira}) \quad \text{se }  \bar{x}_{obs} &lt; \mu_0 \\
\alpha^* &amp;= 2 \times P(\bar{X} &gt; \bar{x}_{obs} \, | \, H_0 \text{
verdadeira}) \quad \text{se }  \bar{x}_{obs} &gt; \mu_0 \\
\end{align*}\]</span></p>
<p>Como estamos calculando a probabilidade para apenas uma das caudas, então esse valor é multiplicado por 2.</p>
</div>
</div>
<div id="teste-de-hipótese-para-a-média" class="section level1">
<h1><span class="header-section-number">3</span> Teste de hipótese para a média</h1>
<div id="variância-conhecida" class="section level2">
<h2><span class="header-section-number">3.1</span> Variância conhecida</h2>
<p>Quando a variância populacional é conhecida, a distribuição amostral da média é <span class="math inline">\(\bar{X} \sim \text{N}(\mu, \sigma^2 / n)\)</span> e a estatística de teste é</p>
<p><span class="math display">\[
z = \frac{\bar{x} - \mu_0}{\sigma/\sqrt{n}} \sim \text{N}(0,1)
\]</span></p>
<p>Suponha que uma amostra de <span class="math inline">\(n=30\)</span> valores foram obtidos de uma VA <span class="math inline">\(X \sim \text{N}(10, 1)\)</span> e deseja-se testar as hipóteses</p>
<p><span class="math display">\[
\begin{align*}
H_0 &amp;: \mu = 10 \\
H_a &amp;: \mu \neq 10
\end{align*}
\]</span></p>
<p>com <span class="math inline">\(\alpha=0.05\)</span>.</p>
<pre class="r"><code>## Simula X ~ N(10, 1)
set.seed(2019-10-29)
n &lt;- 30
x &lt;- rnorm(n, 10, 1)
(med &lt;- mean(x))</code></pre>
<pre><code># [1] 10.08421</code></pre>
<pre class="r"><code>(s2 &lt;- var(x))</code></pre>
<pre><code># [1] 1.158774</code></pre>
<pre class="r"><code>## Teste padrão para
## H0: mu = 10
## Ha: mu != 10
mu0 &lt;- 10
## Estatistica de teste
(zcalc &lt;- (med - mu0)/sqrt(1/n))</code></pre>
<pre><code># [1] 0.4612242</code></pre>
<pre class="r"><code>## Valor critico
(zcrit &lt;- qnorm(.025, mean = 0, sd = 1))</code></pre>
<pre><code># [1] -1.959964</code></pre>
<pre class="r"><code>## p-valor
2 * pnorm(zcalc, mean = 0, sd = 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.6446378</code></pre>
<pre class="r"><code>## Direto, com base na distribuição amostral
2 * pnorm(med, mean = 10, sd = 1/sqrt(n), lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.6446378</code></pre>
<pre class="r"><code>## Usando simulacao de Monte Carlo
N &lt;- 1e4
## Simulando direto da distribuicao amostral, sob H0
am &lt;- rnorm(N, mean = mu0, sd = 1/sqrt(n))
## Simula da populacao e calcula as medias, sob H0
am2 &lt;- replicate(N, mean(rnorm(n, mu0, 1)))
## Visualização
par(mfrow = c(1, 2))
hist(am, main = &quot;Distribuição amostral&quot;)
abline(v = med, col = 2)
hist(am2, main = &quot;Média de amostras&quot;)
abline(v = med, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-3-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))
## p-valor empírico
2 * sum(am &gt;= med)/N</code></pre>
<pre><code># [1] 0.6336</code></pre>
<pre class="r"><code>2 * sum(am2 &gt;= med)/N</code></pre>
<pre><code># [1] 0.646</code></pre>
<pre class="r"><code>## Padroniza a distribuição para N(0,1)
zpad &lt;- (am - mu0)/sqrt(1/n)
hist(zpad)
abline(v = zcalc, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-3-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor empírico
2 * sum(zpad &gt;= zcalc)/N</code></pre>
<pre><code># [1] 0.6336</code></pre>
</div>
<div id="variância-desconhecida" class="section level2">
<h2><span class="header-section-number">3.2</span> Variância desconhecida</h2>
<p>Quando a variância populacional é <strong>desconhecida</strong>, a distribuição amostral da média é <span class="math inline">\(\bar{X} \sim \text{N}(\mu, s^2 / n)\)</span> e a estatística de teste é</p>
<p><span class="math display">\[
t = \frac{\bar{x} - \mu_0}{s/\sqrt{n}} \sim t_{(n-1)}
\]</span></p>
<p>Suponha que uma amostra de <span class="math inline">\(n=30\)</span> valores foram obtidos de uma VA <span class="math inline">\(X \sim \text{N}(10, 1)\)</span>. Na prática não saberemos o verdadeiro valor de <span class="math inline">\(\sigma^2\)</span>, por isso usaremos a variância amostral <span class="math inline">\(s^2\)</span> no lugar de <span class="math inline">\(\sigma^2\)</span>. Assim, deseja-se testar as hipóteses</p>
<p><span class="math display">\[
\begin{align*}
H_0 &amp;: \mu = 10 \\
H_a &amp;: \mu \neq 10
\end{align*}
\]</span></p>
<p>com <span class="math inline">\(\alpha=0.05\)</span>.</p>
<pre class="r"><code>## Simula de N(10, 1), mas agora asumindo que a variância é desconhecida
set.seed(2019-10-29)
n &lt;- 30
x &lt;- rnorm(n, 10, 1)
(med &lt;- mean(x))</code></pre>
<pre><code># [1] 10.08421</code></pre>
<pre class="r"><code>(s2 &lt;- var(x))</code></pre>
<pre><code># [1] 1.158774</code></pre>
<pre class="r"><code>## Teste padrão para
## H0: mu = 10
## Ha: mu != 10
mu0 &lt;- 10
t.test(x = x, alternative = &quot;two.sided&quot;, mu = mu0)</code></pre>
<pre><code># 
#   One Sample t-test
# 
# data:  x
# t = 0.42846, df = 29, p-value = 0.6715
# alternative hypothesis: true mean is not equal to 10
# 95 percent confidence interval:
#   9.68225 10.48617
# sample estimates:
# mean of x 
#  10.08421</code></pre>
<pre class="r"><code>## Estatística de teste
(tcalc &lt;- (med - mu0)/sqrt(s2/n))</code></pre>
<pre><code># [1] 0.4284624</code></pre>
<pre class="r"><code>## Valor crítico
(tcrit &lt;- qt(.025, df = n - 1))</code></pre>
<pre><code># [1] -2.04523</code></pre>
<pre class="r"><code>## p-valor
2 * pt(tcalc, df = n - 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.6714802</code></pre>
<pre class="r"><code>## Teste por simulação de Monte Carlo
N &lt;- 1e4
## Simula direto da distribuição amostral da média
am &lt;- rnorm(N, mean = mu0, sd = sqrt(s2/n))
## Calcula média de amostras de tamanho n da população, com a variância
## estimada a partir dos dados
am2 &lt;- replicate(N, mean(rnorm(n, mu0, sqrt(s2))))
## Visualização
par(mfrow = c(1, 2))
hist(am, main = &quot;Distribuição amostral&quot;)
abline(v = med, col = 2)
hist(am2, main = &quot;Média de amostras&quot;)
abline(v = med, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))
## p-valor empírico
2 * sum(am &gt;= med)/N</code></pre>
<pre><code># [1] 0.6566</code></pre>
<pre class="r"><code>2 * sum(am2 &gt;= med)/N</code></pre>
<pre><code># [1] 0.6678</code></pre>
<pre class="r"><code>## Padroniza a distribuição para t(n - 1)
tpad &lt;- (am - mu0)/sqrt(s2/n)
hist(tpad)
abline(v = tcalc, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-4-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor empírico
2 * sum(tpad &gt;= tcalc)/N</code></pre>
<pre><code># [1] 0.6566</code></pre>
</div>
<div id="comparação-de-duas-médias-variâncias-iguais" class="section level2">
<h2><span class="header-section-number">3.3</span> Comparação de duas médias (variâncias iguais)</h2>
<p>Considere duas populações <span class="math inline">\(X_1\)</span> e <span class="math inline">\(X_2\)</span> com médias <span class="math inline">\(\mu_1\)</span> e <span class="math inline">\(\mu_2\)</span>, e desvios-padrão <span class="math inline">\(\sigma_1\)</span> e <span class="math inline">\(\sigma_2\)</span>, ou seja <span class="math display">\[
X_1 \sim \text{N}(\mu_1, \sigma_1^2)
\qquad\text{e}\qquad
X_2 \sim \text{N}(\mu_2, \sigma_2^2).
\]</span></p>
<p>A “<strong>nova</strong>” variável <span class="math inline">\(\overline{X}_d = (\overline{X}_1 - \overline{X}_2)\)</span> também possui distribuição normal com</p>
<p><span class="math display">\[
\begin{aligned}
\text{E}(\overline{X}_1 - \overline{X}_2) &amp;= \mu_1 - \mu_2 \\
\text{V}(\overline{X}_1 - \overline{X}_2) &amp;=
  \text{V}(\overline{X}_1) + \text{V}(\overline{X}_2) \\
  &amp;= \frac{\sigma^2_1}{n_1} + \frac{\sigma^2_2}{n_2},
\end{aligned}
\]</span></p>
<p>ou seja, a <strong>distribuição amostral da diferença de médias é</strong></p>
<p><span class="math display">\[
\overline{X}_d = (\overline{X}_1 - \overline{X}_2) \sim
  \text{N}\left(\mu_1 - \mu_2,
  \frac{\sigma^2_1}{n_1} + \frac{\sigma^2_2}{n_2}\right).
\]</span></p>
<p>Quando a variância populacional é <strong>desconhecida</strong>, utilizamos <span class="math inline">\(s^2\)</span> como estimativa para <span class="math inline">\(\sigma^2\)</span>, e pode-se considerar dois casos distintos</p>
<ul>
<li><strong>Variâncias iguais:</strong> quando é razoável supor que as variâncias populacionais são iguais, ou seja <span class="math inline">\(\sigma_1^2 = \sigma_2^2\)</span>. Nesse caso a distribuição amostral da diferença média é <span class="math display">\[
\overline{X}_d = (\overline{X}_1 - \overline{X}_2) \sim
\text{N}\left(\mu_1 - \mu_2,
\frac{s^2}{n_1} + \frac{s^2}{n_2}\right)
\]</span> onde <span class="math inline">\(s^2\)</span> é média ponderada das variâncias amostrais <span class="math display">\[
s^2 = \frac{(n_1 - 1) \cdot s_1^2 + (n_2 - 1)
  \cdot s_2^2}{n_1 + n_2 - 2}
\]</span></li>
<li><strong>Variâncias diferentes:</strong> quando não se pode fazer nenhuma suposição sobre a igualdade das variâncias populacionais, ou seja <span class="math inline">\(\sigma_1^2 \neq \sigma_2^2\)</span>. Nesse caso a distribuição amostral da diferença média é <span class="math display">\[
\overline{X}_d = (\overline{X}_1 - \overline{X}_2) \sim
\text{N}\left(\mu_1 - \mu_2,
\frac{s^2_1}{n_1} + \frac{s^2_2}{n_2}\right)
\]</span> onde <span class="math inline">\(s^2_1\)</span> e <span class="math inline">\(s^2_2\)</span> são as variâncias de cada amostra (na estatística de teste os graus de liberdade precisam ser ajustados corretamente).</li>
</ul>
<div id="exemplo-chacais" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Exemplo (chacais)</h3>
<p>O exemplo abaixo é uma adaptação de um exemplo clássico analisado por <span class="citation">Manly (2006)</span>. Os dados se referem ao comprimento das mandíbulas de 20 exemplares de chacais (10 de cada sexo) disponíveis no Museu de História Natural Britânico.</p>
<p>Considere que <span class="math inline">\(\mu_1\)</span> seja a média populacional dos comprimentos das mandíbulas de chacaias machos, e que <span class="math inline">\(\mu_2\)</span> se refere às fêmeas. Os pesquisadores supõem que as mandíbulas dos machos são, em média, maiores que as das fêmeas. Dessa forma um teste de hipótese pode ser formulado com as seguintes hipóteses</p>
<p><span class="math display">\[
\begin{align*}
H_0 &amp;: \mu_1 - \mu_2 = 0 \Rightarrow \mu_1 = \mu_2 \\
H_a &amp;: \mu_1 - \mu_2 &gt; 0 \Rightarrow \mu_1 &gt; \mu_2
\end{align*}
\]</span></p>
<p>As variâncias populacionais são desconhecidas, mas assume-se que sejam iguais, portanto a estatística de teste é</p>
<p><span class="math display">\[
t = \frac{(\overline{x}_1 - \overline{x}_2) - (\mu_1 - \mu_2)}{
  \displaystyle\sqrt{\frac{s^2}{n_1} +
  \displaystyle\frac{s^2}{n_2}}} =
\frac{\overline{x}_1 - \overline{x}_2}{
  \displaystyle\sqrt{\frac{s^2}{n_1} +
  \displaystyle\frac{s^2}{n_2}}} \sim t_\nu,
\]</span></p>
<p>onde</p>
<p><span class="math display">\[
s^2 = \frac{(n_1 - 1) \cdot s_1^2 + (n_2 - 1) \cdot s_2^2}
  {n_1 + n_2 - 2}
\]</span> e <span class="math display">\[
\nu = n_1 + n_2 - 2
\]</span> são os graus de liberdade.</p>
<pre class="r"><code>## Exemplo adaptado de Manly (1997)
## Comparação do comprimento da mandíbula de chacais machos e fêmeas
set.seed(2)
machos &lt;- c(120, 107, 110, 116, 114, 111, 113, 117, 114, 112)
## Simula diferença para as femeas
femeas &lt;- rnorm(10, mean(machos) - 2, sd = sd(machos))
da &lt;- data.frame(comp = c(machos, femeas),
                 sexo = c(rep(&quot;M&quot;, 10), rep(&quot;F&quot;, 10)))
densityplot(~comp, groups = sexo, data = da, auto.key = TRUE)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Média por sexo
tapply(da$comp, da$sexo, mean)</code></pre>
<pre><code>#       F       M 
# 112.185 113.400</code></pre>
<pre class="r"><code>## Diferença das médias
diff(tapply(da$comp, da$sexo, mean))</code></pre>
<pre><code>#        M 
# 1.214975</code></pre>
<div id="procedimento-padrão-1" class="section level4 unnumbered">
<h4>Procedimento padrão</h4>
<pre class="r"><code>## Teste F para igualdade de variâncias
var.test(x = machos, y = femeas)</code></pre>
<pre><code># 
#   F test to compare two variances
# 
# data:  machos and femeas
# F = 1.0307, num df = 9, denom df = 9, p-value = 0.9648
# alternative hypothesis: true ratio of variances is not equal to 1
# 95 percent confidence interval:
#  0.2560149 4.1496511
# sample estimates:
# ratio of variances 
#           1.030715</code></pre>
<pre class="r"><code>## Média de cada sexo
(m1 &lt;- mean(machos))</code></pre>
<pre><code># [1] 113.4</code></pre>
<pre class="r"><code>(m2 &lt;- mean(femeas))</code></pre>
<pre><code># [1] 112.185</code></pre>
<pre class="r"><code>## Diferença entre as médias amostrais
(med.amostral &lt;- m1 - m2)</code></pre>
<pre><code># [1] 1.214975</code></pre>
<pre class="r"><code>## Calcula o desvio padrão ponderado
n1 &lt;- length(machos)
v1 &lt;- var(machos)
n2 &lt;- length(femeas)
v2 &lt;- var(femeas)
(s.pond &lt;- sqrt(((n1 - 1) * v1 + (n2 - 1) * v2)/(n1 + n2 - 2)))</code></pre>
<pre><code># [1] 3.690024</code></pre>
<pre class="r"><code>## Teste de hipótese para
## H0: mu1 = mu2
## Ha: mu1 &gt; mu2
mu0 &lt;- 0
t.test(x = machos, y = femeas, alternative = &quot;greater&quot;,
       var.equal = TRUE, mu = mu0)</code></pre>
<pre><code># 
#   Two Sample t-test
# 
# data:  machos and femeas
# t = 0.73625, df = 18, p-value = 0.2355
# alternative hypothesis: true difference in means is greater than 0
# 95 percent confidence interval:
#  -1.646627       Inf
# sample estimates:
# mean of x mean of y 
#   113.400   112.185</code></pre>
<pre class="r"><code>## Estatística de teste
(tcalc &lt;- (m1 - m2)/(s.pond * sqrt(1/n1 + 1/n2)))</code></pre>
<pre><code># [1] 0.7362465</code></pre>
<pre class="r"><code>## Valor crítico
(tcrit &lt;- qt(.025, df = n1 + n2 - 2, lower.tail = FALSE))</code></pre>
<pre><code># [1] 2.100922</code></pre>
<pre class="r"><code>## p-valor
pt(tcalc, df = n1 + n2 - 2, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.2355338</code></pre>
</div>
<div id="usando-simulação-de-monte-carlo" class="section level4 unnumbered">
<h4>Usando simulação de Monte Carlo</h4>
<pre class="r"><code>## Teste por simulação de Monte Carlo
N &lt;- 1e4
## Simula direto da distribuição amostral
am &lt;- replicate(N, rnorm(1, mu0, s.pond * sqrt(1/n1 + 1/n2)))</code></pre>
<p>Para simular direto dos dados, partimos da hipótese nula de que as duas médias são iguais, e as variâncias são as mesmas. Nesse caso, podemos simular assumindo que a média é igual à média dos machos, e da mesma forma, podemos assumir que a média da população é igual a média das fêmeas.</p>
<pre class="r"><code>## Usando media dos machos: obtém a diferença das médias entre machos e
## fêmeas, assumindo que a média na população é igual a média dos machos
am.machos &lt;- replicate(
    N, diff(tapply(rnorm(20, m1, s.pond), da$sexo, mean))
)
## Usando media das femeas: obtém a diferença das médias entre machos e
## fêmeas, assumindo que a média na população é igual a média dos fêmeas
am.femeas &lt;- replicate(
    N, diff(tapply(rnorm(20, m2, s.pond), da$sexo, mean))
)

## Visualização
par(mfrow = c(1, 3))
hist(am, main = &quot;Distribuição amostral&quot;)
abline(v = med.amostral, col = 2)
hist(am.machos, main = &quot;Média de amostras (machos)&quot;)
abline(v = med.amostral, col = 2)
hist(am.femeas, main = &quot;Média de amostras (fêmeas)&quot;)
abline(v = med.amostral, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))
## p-valor empírico
sum(am &gt;= med.amostral)/N</code></pre>
<pre><code># [1] 0.2342</code></pre>
<pre class="r"><code>sum(am.machos &gt;= med.amostral)/N</code></pre>
<pre><code># [1] 0.225</code></pre>
<pre class="r"><code>sum(am.femeas &gt;= med.amostral)/N</code></pre>
<pre><code># [1] 0.2361</code></pre>
<pre class="r"><code>## Padroniza a distribuição para t(n1 + n2 - 2)
tpad &lt;- (am - mu0)/(s.pond * sqrt(1/n1 + 1/n2))
hist(tpad)
abline(v = tcalc, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-8-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor
sum(tpad &gt;= tcalc)/N</code></pre>
<pre><code># [1] 0.2342</code></pre>
</div>
<div id="quando-o-método-pode-não-ser-muito-bom" class="section level4 unnumbered">
<h4>Quando o método pode não ser muito bom</h4>
<p>Aqui usamos os dados originais de <span class="citation">Manly (2006)</span>.</p>
<pre class="r"><code>## Exemplo original do Manly (1997)
machos &lt;- c(120, 107, 110, 116, 114, 111, 113, 117, 114, 112)
femeas &lt;- c(110, 111, 107, 108, 110, 105, 107, 106, 111, 111)
da &lt;- data.frame(comp = c(machos, femeas),
                 sexo = c(rep(&quot;M&quot;, 10), rep(&quot;F&quot;, 10)))
densityplot(~comp, groups = sexo, data = da, auto.key = TRUE)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Média por sexo
tapply(da$comp, da$sexo, mean)</code></pre>
<pre><code>#     F     M 
# 108.6 113.4</code></pre>
<pre class="r"><code>## Diferença das médias
diff(tapply(da$comp, da$sexo, mean))</code></pre>
<pre><code>#   M 
# 4.8</code></pre>
<pre class="r"><code>## Média de cada sexo
(m1 &lt;- mean(machos))</code></pre>
<pre><code># [1] 113.4</code></pre>
<pre class="r"><code>(m2 &lt;- mean(femeas))</code></pre>
<pre><code># [1] 108.6</code></pre>
<pre class="r"><code>## Diferença entre as médias amostrais
(med.amostral &lt;- m1 - m2)</code></pre>
<pre><code># [1] 4.8</code></pre>
<pre class="r"><code>## Calcula o desvio padrão ponderado
n1 &lt;- length(machos)
v1 &lt;- var(machos)
n2 &lt;- length(femeas)
v2 &lt;- var(femeas)
(s.pond &lt;- sqrt(((n1 - 1) * v1 + (n2 - 1) * v2)/(n1 + n2 - 2)))</code></pre>
<pre><code># [1] 3.080404</code></pre>
<pre class="r"><code>## Teste F para igualdade de variâncias
var.test(x = machos, y = femeas)</code></pre>
<pre><code># 
#   F test to compare two variances
# 
# data:  machos and femeas
# F = 2.681, num df = 9, denom df = 9, p-value = 0.1579
# alternative hypothesis: true ratio of variances is not equal to 1
# 95 percent confidence interval:
#   0.665931 10.793829
# sample estimates:
# ratio of variances 
#           2.681034</code></pre>
<pre class="r"><code>## Teste de hipótese para
## H0: mu1 = mu2
## Ha: mu1 &gt; mu2
mu0 &lt;- 0
t.test(x = machos, y = femeas, alternative = &quot;greater&quot;,
       var.equal = TRUE, mu = mu0)</code></pre>
<pre><code># 
#   Two Sample t-test
# 
# data:  machos and femeas
# t = 3.4843, df = 18, p-value = 0.001324
# alternative hypothesis: true difference in means is greater than 0
# 95 percent confidence interval:
#  2.411156      Inf
# sample estimates:
# mean of x mean of y 
#     113.4     108.6</code></pre>
<pre class="r"><code>## Estatística de teste
(tcalc &lt;- (m1 - m2)/(s.pond * sqrt(1/n1 + 1/n2)))</code></pre>
<pre><code># [1] 3.484324</code></pre>
<pre class="r"><code>## Valor crítico
(tcrit &lt;- qt(.025, df = n1 + n2 - 2, lower.tail = FALSE))</code></pre>
<pre><code># [1] 2.100922</code></pre>
<pre class="r"><code>## p-valor
pt(tcalc, df = n1 + n2 - 2, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.001323634</code></pre>
<pre class="r"><code>## Teste por simulação de Monte Carlo
N &lt;- 1e5 # NOTE o aumento no número de simulações
## Simula direto da distribuição amostral
library(future.apply) # para um replicate mais eficiente (em paralelo)</code></pre>
<pre><code># Loading required package: future</code></pre>
<pre class="r"><code>plan(multicore, workers = 4)
am &lt;- future_replicate(N, rnorm(1, mu0, s.pond * sqrt(1/n1 + 1/n2)))
## Usando media dos machos
am.machos &lt;- future_replicate(
    N, diff(tapply(rnorm(20, m1, s.pond), da$sexo, mean))
)
## Usando media das femeas
am.femeas &lt;- future_replicate(
    N, diff(tapply(rnorm(20, m2, s.pond), da$sexo, mean))
)

## Visualização
par(mfrow = c(1, 3))
hist(am, main = &quot;Distribuição amostral&quot;)
abline(v = med.amostral, col = 2)
hist(am.machos, main = &quot;Média de amostras (machos)&quot;)
abline(v = med.amostral, col = 2)
hist(am.femeas, main = &quot;Média de amostras (fêmeas)&quot;)
abline(v = med.amostral, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-9-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))

## p-valor empírico
format(sum(am &gt;= med.amostral)/N, digits = 10, scientific = FALSE)</code></pre>
<pre><code># [1] &quot;0.00023&quot;</code></pre>
<pre class="r"><code>format(sum(am.machos &gt;= med.amostral)/N, digits = 10, scientific = FALSE)</code></pre>
<pre><code># [1] &quot;0.00019&quot;</code></pre>
<pre class="r"><code>format(sum(am.femeas &gt;= med.amostral)/N, digits = 10, scientific = FALSE)</code></pre>
<pre><code># [1] &quot;0.00019&quot;</code></pre>
<pre class="r"><code>## Padroniza a distribuição para t(n1 + n2 - 2)
tpad &lt;- (am - mu0)/(s.pond * sqrt(1/n1 + 1/n2))
hist(tpad)
abline(v = tcalc, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-9-3.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor
sum(tpad &gt;= tcalc)/N</code></pre>
<pre><code># [1] 0.00023</code></pre>
<p>Isso mostra que a simulação pode não conseguir representar casos extremos, embora a conclusão não seria alterada.</p>
</div>
</div>
</div>
</div>
<div id="teste-de-hipótese-para-uma-proporção" class="section level1">
<h1><span class="header-section-number">4</span> Teste de hipótese para uma proporção</h1>
<p>Se <span class="math inline">\(Y \sim \text{Ber}(p)\)</span>, então a proporção amostral <span class="math display">\[
  \hat{p} = \frac{1}{n} \sum_{i=1}^{n} y_i
\]</span> é a <strong>melhor estimativa</strong> para a proporção populacional <span class="math inline">\(p\)</span>.</p>
<p>Já vimos que, quando ambas condições são satisfeitas,</p>
<ul>
<li><span class="math inline">\(np \geq 5\)</span></li>
<li><span class="math inline">\(n(1 - p) \geq 5\)</span>,</li>
</ul>
<p>a distribuição amostral de <span class="math inline">\(\hat{p}\)</span> pode ser aproximada (pelo TLC) por <span class="math display">\[
  \hat{p} \overset{\text{aprox}}{\sim}
  \text{N}\left(p, \frac{p(1 - p)}{n} \right).
\]</span></p>
<p>Podemos usar a distribuição Normal como aproximação da Binomial e, portanto, usamos a <strong>estatística de teste</strong> <span class="math display">\[
  z = \frac{\hat{p} - p_0}{\sqrt{\frac{p_0 (1 - p_0)}{n}}}
  \sim \text{N}(0, 1)
\]</span> em que <span class="math inline">\(p_0\)</span> é o valor de proporção de teste na hipótese nula.</p>
<div id="exemplo" class="section level2">
<h2><span class="header-section-number">4.1</span> Exemplo</h2>
<p>Suponha que em uma amostra de <span class="math inline">\(n=250\)</span> itens, 32 apresentaram algum tipo de defeito. Deseja-se testas as hipóteses</p>
<p><span class="math display">\[
\begin{align*}
H_0 &amp;: p = 0.15\\
H_a &amp;: p &lt; 0.15
\end{align*}
\]</span></p>
<pre class="r"><code>## Dados: y = 32 sucessos em n = 250 tentativas
n &lt;- 250
y &lt;- 32

## Proporção amostral
(theta.hat &lt;- y/n)</code></pre>
<pre><code># [1] 0.128</code></pre>
<pre class="r"><code>## Teste de hipótese
## H0: theta = 0.15
## Ha: theta &lt; 0.15
theta0 &lt;- 0.15
## A aproximação pela normal funciona bem quando
## np &gt;= 5 e n(1-p) &gt;=5
n * theta.hat</code></pre>
<pre><code># [1] 32</code></pre>
<pre class="r"><code>n * (1 - theta.hat)</code></pre>
<pre><code># [1] 218</code></pre>
<pre class="r"><code>## Estatistica de teste (aproximação pela normal)
(zcalc &lt;- (theta.hat - theta0)/sqrt((theta0 * (1 - theta0))/n))</code></pre>
<pre><code># [1] -0.9741764</code></pre>
<pre class="r"><code>## Com alpha = 0.05, o valor cítico é
(zcrit &lt;- qnorm(.05))</code></pre>
<pre><code># [1] -1.644854</code></pre>
<pre class="r"><code>## p-valor
pnorm(zcalc)</code></pre>
<pre><code># [1] 0.1649845</code></pre>
<pre class="r"><code>pbinom(y, size = n, prob = theta0) # teste exato</code></pre>
<pre><code># [1] 0.1890489</code></pre>
<pre class="r"><code>binom.test(x = 32, n = 250, p = 0.15, alternative = &quot;less&quot;)</code></pre>
<pre><code># 
#   Exact binomial test
# 
# data:  32 and 250
# number of successes = 32, number of trials = 250, p-value = 0.189
# alternative hypothesis: true probability of success is less than 0.15
# 95 percent confidence interval:
#  0.0000000 0.1680901
# sample estimates:
# probability of success 
#                  0.128</code></pre>
<pre class="r"><code>## Aproximação (com correção de continuidade)
prop.test(x = 32, n = 250, p = 0.15, alternative = &quot;less&quot;)</code></pre>
<pre><code># 
#   1-sample proportions test with continuity correction
# 
# data:  32 out of 250, null probability 0.15
# X-squared = 0.78431, df = 1, p-value = 0.1879
# alternative hypothesis: true p is less than 0.15
# 95 percent confidence interval:
#  0.0000000 0.1689838
# sample estimates:
#     p 
# 0.128</code></pre>
<pre class="r"><code>## Aproximação (SEM correção de continuidade): similar à aproximação
## pela Normal
prop.test(x = 32, n = 250, p = 0.15, alternative = &quot;less&quot;,
          correct = FALSE)</code></pre>
<pre><code># 
#   1-sample proportions test without continuity correction
# 
# data:  32 out of 250, null probability 0.15
# X-squared = 0.94902, df = 1, p-value = 0.165
# alternative hypothesis: true p is less than 0.15
# 95 percent confidence interval:
#  0.0000000 0.1667801
# sample estimates:
#     p 
# 0.128</code></pre>
<pre class="r"><code>## Teste por simulação de Monte Carlo
N &lt;- 1e4
## Simula direto da distribuição amostral da proporção (aproximada pela
## normal)
am &lt;- rnorm(N, mean = theta0, sd = sqrt((theta0 * (1 - theta0))/n))
## Simula direto da população, sob theta0
am2 &lt;- rbinom(N, size = n, prob = theta0)
## Calcula a proporção amostral
am2 &lt;- am2/n

## Visualização
par(mfrow = c(1, 2))
hist(am, main = &quot;Distribuição amostral&quot;, freq = FALSE)
## Aproximação pela normal
curve(dnorm(x, theta0, sqrt((theta0 * (1 - theta0))/n)),
      from = 0, to = .3, add = TRUE, col = 2)
abline(v = theta.hat, col = 2)
hist(am2, main = &quot;Proporções de amostras&quot;, freq = FALSE)
## Aproximação pela normal
curve(dnorm(x, theta0, sqrt((theta0 * (1 - theta0))/n)),
      from = 0, to = .3, add = TRUE, col = 2)
abline(v = theta.hat, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))

## p-valor empírico
sum(am &lt;= theta.hat)/N</code></pre>
<pre><code># [1] 0.1671</code></pre>
<pre class="r"><code>sum(am2 &lt;= theta.hat)/N # mais próximo ao teste exato</code></pre>
<pre><code># [1] 0.1871</code></pre>
<pre class="r"><code>## Padroniza a distribuição para N(0,1)
zpad &lt;- (am - theta0)/sqrt((theta0 * (1 - theta0))/n)
hist(zpad, freq = FALSE)
curve(dnorm, -3, 3, add = TRUE, col = 2)
abline(v = zcalc, col = 2)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-10-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor empírico
sum(zpad &lt;= zcalc)/N</code></pre>
<pre><code># [1] 0.1671</code></pre>
<!--
## Exemplo (moedas)

Suponha que uma pessoa lançou uma moeda 70 vezes e marcou 1 quando caiu
cara e 0 quando saiu coroa. Esse foi o resultado obtido


```r
x <- c(1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0,
       0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1,
       1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0,
       0, 1, 0, 1, 1, 0, 0, 0)
## Proporção amostral
sum(x)/length(x)
```

```
# [1] 0.4571429
```

Mas não estamos interessados em saber a proporção de caras e coroas, mas
sim quantas vezes a face da moeda mudou durante o experimento.


```r
## Número de trocas de face
(o <- sum(abs(diff(x))))
```

```
# [1] 27
```

Podemos então simular desse experimento


```r
## Função que lança uma moeda verdadeira e retorna o número de
## trocas. Ela reproduz o experimento sob a hipótese nula, ou seja, com
## p=0.5 e lançamentos independentes (sem memória).
moeda <- function(n){
    sum(abs(diff(sample(0:1, n, replace=TRUE))))
}
moeda(70)
```

```
# [1] 39
```

```r
## Faz várias execuções do experimento aleatório.
r <- replicate(100000, moeda(70))

## A distribuição amostral da estatística número de trocas.
hist(r, breaks=seq(min(r), max(r)+1, by=1)-0.5, prob=TRUE,
     xlab="Número de trocas em 70 lançamentos",
     ylab="Densidade", main=NULL)
abline(v=o, col=2)
text(x=o, y=par()$usr[4], label="Estatística observada", srt=90,
     adj=c(1.25,-0.25))
```

<img src="figures/09_MC_inf_testes/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;" />

```r
plot(ecdf(r))
abline(v=o, col=2)
text(x=o, y=par()$usr[4], label="Estatística observada", srt=90,
     adj=c(1.25,-0.25))
```

<img src="figures/09_MC_inf_testes/unnamed-chunk-13-2.png" width="80%" style="display: block; margin: auto;" />

```r
## Como a v.a. é discreta.
sum(r<=o)/length(r)
```

```
# [1] 0.04476
```

```r
sum(r<o)/length(r)
```

```
# [1] 0.02568
```

```r
pbinom(o, 70, prob = 0.5)
```

```
# [1] 0.03611896
```

```r
prop.test(x = 27, n = 70, alternative = "less")
```

```
# 
#   1-sample proportions test with continuity correction
# 
# data:  27 out of 70, null probability 0.5
# X-squared = 3.2143, df = 1, p-value = 0.0365
# alternative hypothesis: true p is less than 0.5
# 95 percent confidence interval:
#  0.0000000 0.4911405
# sample estimates:
#         p 
# 0.3857143
```

```r
binom.test(x = 27, n = 70, alternative = "less")
```

```
# 
#   Exact binomial test
# 
# data:  27 and 70
# number of successes = 27, number of trials = 70, p-value = 0.03612
# alternative hypothesis: true probability of success is less than 0.5
# 95 percent confidence interval:
#  0.000000 0.490866
# sample estimates:
# probability of success 
#              0.3857143
```

```r
2 * sum(r<=o)/length(r)
```

```
# [1] 0.08952
```

```r
2 * sum(r<o)/length(r)
```

```
# [1] 0.05136
```

```r
prop.test(x = 27, n = 70, alternative = "two.sided")
```

```
# 
#   1-sample proportions test with continuity correction
# 
# data:  27 out of 70, null probability 0.5
# X-squared = 3.2143, df = 1, p-value = 0.073
# alternative hypothesis: true p is not equal to 0.5
# 95 percent confidence interval:
#  0.2740797 0.5099641
# sample estimates:
#         p 
# 0.3857143
```

```r
binom.test(x = 27, n = 70, alternative = "two.sided")
```

```
# 
#   Exact binomial test
# 
# data:  27 and 70
# number of successes = 27, number of trials = 70, p-value = 0.07224
# alternative hypothesis: true probability of success is not equal to 0.5
# 95 percent confidence interval:
#  0.2717200 0.5097006
# sample estimates:
# probability of success 
#              0.3857143
```

```r
## A distribuição do número de trocas sob H0 é uma Binomial.
i <- 0:69
p <- pbinom(i, size=69, p=0.5)

plot(ecdf(r), verticals=TRUE, cex=NA, main=NULL,
     xlab="Número de trocas em 70 lançamentos",
     ylab="Probabilidade acumulada")
lines(p~i, type="s", col=2)
legend("right",
       legend=c("Distribuição empírica", "Distribuição teórica"),
       col=1:2, lty=1, bty="n")
```

<img src="figures/09_MC_inf_testes/unnamed-chunk-13-3.png" width="80%" style="display: block; margin: auto;" />
-->
</div>
</div>
<div id="cálculo-da-taxa-empírica-do-erro-do-tipo-i" class="section level1">
<h1><span class="header-section-number">5</span> Cálculo da taxa empírica do erro do tipo I</h1>
<pre class="r"><code>## Obtém o valor da estatística t do teste de Student para a média de
## uma população. Assume que a distribuição de X seja normal.
simula0 &lt;- function(n, mu0, sig0){
    X &lt;- rnorm(n, mean=mu0, sd=sig0)
    T &lt;- (mean(X)-mu0)/(sqrt(var(X)/n))
    return(T)
}

simula0(n=10, mu0=0, sig0=1)</code></pre>
<pre><code># [1] 0.1239222</code></pre>
<pre class="r"><code>t &lt;- replicate(10000, simula0(n=10, mu0=0, sig0=1))

## Comparação por distribuições acumuladas.
par(mfrow = c(1, 2))
plot(ecdf(t), xlim=c(-5, 5))
curve(pt(x, df=10-1), add=TRUE, col=2)
curve(pnorm(x), add=TRUE, col=3)
## Comparação pela densidade.
plot(density(t), xlim=c(-5, 5))
curve(dt(x, df=10-1), add=TRUE, col=2)
curve(dnorm(x), add=TRUE, col=3)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))

## p-valor da simulação.
sum(abs(t) &gt;= qt(0.975, df=10-1))/length(t)</code></pre>
<pre><code># [1] 0.0482</code></pre>
<pre class="r"><code>sum(abs(t) &gt;= qt(0.95, df=10-1))/length(t)</code></pre>
<pre><code># [1] 0.0989</code></pre>
<pre class="r"><code>## Distribuição da estatística com afastamento dos pressupostos sobre a
## distribuição da população (X) que não tem distribuição normal.
simula1 &lt;- function(n, mu0=1){
    X &lt;- rexp(n, 1)
    T &lt;- (mean(X)-mu0)/(sqrt(var(X)/n))
    return(T)
}

## Tamanho da amostra da exponencial
n &lt;- 5
t &lt;- replicate(10000, simula1(n=n))

plot(ecdf(t), xlim=c(-5, 5))
curve(pt(x, df=n-1), add=TRUE, col=2)
curve(pnorm(x), add=TRUE, col=3)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-15-2.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor real vs nível se significância nominal.
sum(abs(t) &gt;= qt(0.975, df=n-1))/length(t)</code></pre>
<pre><code># [1] 0.1131</code></pre>
<pre class="r"><code>sum(abs(t) &gt;= qt(0.95, df=n-1))/length(t)</code></pre>
<pre><code># [1] 0.1646</code></pre>
<pre class="r"><code>## O que aconteceria se o tamanho da amostra da exponanecial fosse
## maior?
n &lt;- 50
t &lt;- replicate(10000, simula1(n=n))

plot(ecdf(t), xlim=c(-5, 5))
curve(pt(x, df=n-1), add=TRUE, col=2)
curve(pnorm(x), add=TRUE, col=3)</code></pre>
<p><img src="figures/09_MC_inf_testes/unnamed-chunk-15-3.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## p-valor real vs nível se significância nominal.
sum(abs(t) &gt;= qt(0.975, df=n-1))/length(t)</code></pre>
<pre><code># [1] 0.0631</code></pre>
<pre class="r"><code>sum(abs(t) &gt;= qt(0.95, df=n-1))/length(t)</code></pre>
<pre><code># [1] 0.1115</code></pre>
</div>
<div id="referências" class="section level1 unnumbered">
<h1>Referências</h1>
<div id="refs" class="references">
<div id="ref-Besag1989">
<p>Besag, Julian, and Peter Clifford. 1989. “Generalized Monte Carlo Significance Tests.” <em>Biometrika</em> 76 (4): 633. <a href="https://doi.org/10.2307/2336623">https://doi.org/10.2307/2336623</a>.</p>
</div>
<div id="ref-Manly2006">
<p>Manly, Bryan F. J. 2006. <em>Randomization, Bootstrap and Monte Carlo Methods in Biology</em>. Boca Raton: Chapman &amp; Hall/CRC.</p>
</div>
</div>
</div>

<center>
  <hr width="100%" size="3px">
  <p> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.pt_BR">
      <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" alt="Licença Creative Commons 4.0"> </a>
  </p>
  <p> <font size="2"> Este conteúdo
      está disponível por meio da Licença Creative Commons 4.0 </font>
  </p>
</center>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
