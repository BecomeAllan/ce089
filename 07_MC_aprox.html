<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Fernando P. Mayer" />


<title>Métodos de Monte Carlo</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66454501-13"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-66454501-13');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="default" type="text/css" />
<link rel="stylesheet" href="config/sydney-site.css" type="text/css" />
<link rel="stylesheet" href="config/sydney-site-fonts.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CE089</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="aulas.html">Aulas</a>
</li>
<li>
  <a href="referencias.html">Referências</a>
</li>
<li>
  <a href="materiais.html">Materiais</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leg-ufpr/ce089">
    <span class="fab fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Métodos de Monte Carlo</h1>
<h3 class="subtitle">Distribuições aproximadas baseadas em simulação de Monte Carlo</h3>
<h4 class="author">Fernando P. Mayer</h4>

</div>


<!-- # Introdução -->
<!-- # Aproximação de $\pi$ -->
<!-- ## Método do círculo/quadrado -->
<!-- ## Agulha de Buffon -->
<div id="aproximação-de-integrais" class="section level1">
<h1><span class="header-section-number">1</span> Aproximação de integrais</h1>
<p>Já vimos que a integração de Monte Carlo serve para aproximar integrais de alta dimensão ou que não possuem solução fechada (analítica).</p>
<p>Agora veremos que a integração de Monte Carlo, naturalmente serve também para o cáculo de probabilidades entre algum intervalo, e.g., <span class="math inline">\(P[a &lt; X &lt; b]\)</span> ou <span class="math inline">\(P[X &gt; a]\)</span>, que nada mais são do que cálculos de áreas no intervalo especificado.</p>
<p>A integração de Monte Carlo nos fornece uma estimativa dessa integral, e, como vimos, o erro padrão dessa estimativa pode ser calculado, e intervalos de confiança podem ser obtidos devido à suposição de que assintoticamente a estimativa possui distribuição normal.</p>
<p>Agora, veremos que podemos obter essa mesma estimativa, mas de uma forma um pouco diferente: simulando a própria distribuição de interesse, e obtendo valores de áreas (integrais) usando a própria amostra. A vantagem é que, dessa forma, obtemos uma descrição mais completa do problema em questão, e, com isso, podemos obter outras medidas que forem necessárias, de uma única vez. Além disso, medidas de incerteza como erros-padrões e intervalos de confiança podem ser derivados a partir da própria distribuição amostral.</p>
<p>A obtenção de uma amostra da distribuição de interesse será fundamental para os métodos de inferência que veremos mais adiante. Além disso, estes métodos são utilizados como o “padrão” para a resolução de problemas em inferência bayesiana.</p>
<div id="integração-de-monte-carlo" class="section level2">
<h2><span class="header-section-number">1.1</span> Integração de Monte Carlo</h2>
<p>Como vimos, a integração <strong>simples</strong> de Monte Carlo é um algoritmo <strong>não sequencial</strong> (i.e., os valores amostrados são independentes) para aproximação de integrais do tipo <span class="math display">\[
\theta = \int_a^b g(x) dx
\]</span></p>
<p>através da relação</p>
<p><span class="math display">\[\begin{align*}
\theta &amp;= \int_a^b g(x) f(x) dx \\
  &amp;= (b-a) \int_a^b g(x) \frac{1}{b-a} dx \\
  &amp;= (b-a) \text{E}[g(X)]
\end{align*}\]</span></p>
<p>onde <span class="math inline">\(X \sim \text{U}(a, b)\)</span>.</p>
<p>De maneira geral, para calcular <span class="math inline">\(\theta = \int_a^b g(x) dx\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Gere <span class="math inline">\(X_1, \ldots, X_m\)</span> de <span class="math inline">\(U(a,b)\)</span></li>
<li>Calcule <span class="math inline">\(\overline{g(x)} = \frac{1}{m}\sum_{i=1}^{m} g(x_i)\)</span></li>
<li><span class="math inline">\(\hat\theta = (b-a)\overline{g(x)}\)</span></li>
</ol>
<div id="exemplo-exponencial" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Exemplo (exponencial)</h3>
<p>Para obter a estimativa de <span class="math display">\[
\theta = \int_0^1 e^{-x} dx
\]</span> fazemos:</p>
<pre class="r"><code>## Obtem m valores da U(0,1)
m &lt;- 10000
x &lt;- runif(m)
## Calcula g(x)
theta.hat &lt;- exp(-x)
## Calcula a média
(m.theta.hat &lt;- sum(theta.hat)/m)</code></pre>
<pre><code># [1] 0.6337583</code></pre>
<pre class="r"><code>## Solução analítica
(theta &lt;- 1 - exp(-1))</code></pre>
<pre><code># [1] 0.6321206</code></pre>
<p>Para obter a estimativa de <span class="math display">\[
\theta = \int_2^4 e^{-x} dx
\]</span> fazemos:</p>
<pre class="r"><code>## Obtem m valores da U(2,4)
m &lt;- 10000
a &lt;- 2; b &lt;- 4
x &lt;- runif(m, min = a, max = b)
## Calcula g(x)
theta.hat &lt;- exp(-x)
## Calcula a média * (b - a)
(m.theta.hat &lt;- (sum(theta.hat)/m) * (b - a))</code></pre>
<pre><code># [1] 0.1167288</code></pre>
<pre class="r"><code>## Solução analítica
(theta &lt;- exp(-2) - exp(-4))</code></pre>
<pre><code># [1] 0.1170196</code></pre>
<p>Vemos que, nos dois casos acima, estamos na verdade obtendo uma estimativa das probabilidades <span class="math inline">\(P[0&lt;X&lt;1]\)</span> e <span class="math inline">\(P[2&lt;X&lt;4]\)</span>, respectivamente.</p>
<p>No entanto, se quisermos calcular a seguinte probabilidade <span class="math display">\[
P[X&gt;2] = \int_2^{\infty} e^{-x} dx
\]</span></p>
<p>Nesse caso, a integração simples de Monte Carlo não é útil, pois não é possível que o limite de integração seja indefinido.</p>
<p>Na verdade, <strong>poderíamos</strong> pensar em uma aproximação <strong>grosseira</strong>, supondo que vamos amostrar de <span class="math inline">\(X \sim \text{U}(2, \infty)\)</span>, onde podemos aproximar o valor de <span class="math inline">\(\infty\)</span> por um número grande. Por exemplo:</p>
<pre class="r"><code>## Obtem m valores da U(2,Inf)
m &lt;- 10000
a &lt;- 2; b &lt;- 1e5
x &lt;- runif(m, min = a, max = b)
## Calcula g(x)
theta.hat &lt;- exp(-x)
## Calcula a média * (b - a)
(m.theta.hat &lt;- (sum(theta.hat)/m) * (b - a))</code></pre>
<pre><code># [1] 0.2770476</code></pre>
<pre class="r"><code>## Solução analítica
(theta &lt;- exp(-2) - exp(-1e5))</code></pre>
<pre><code># [1] 0.1353353</code></pre>
<pre class="r"><code>## Usando a exponencial
pexp(2, 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.1353353</code></pre>
<p>Note que o valor estimado nesse caso está longe do velor correto, pois estamos adotando um procedimento <strong>completamente arbitrário</strong>.</p>
</div>
<div id="exemplo-beta" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Exemplo (beta)</h3>
<p>Considere que uma VA <span class="math inline">\(X\)</span> tem distribuição <span class="math inline">\(\text{Beta}(a=9.39, b=33.67)\)</span>, e queremos obter <span class="math inline">\(P[0.3 &lt; X &lt; 0.5]\)</span>, ou seja,</p>
<p><span class="math display">\[
P[0.3 &lt; X &lt; 0.5] = \int_{0.3}^{0.5}
\frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)} x^a (1-x)^{b} dx
\]</span></p>
<p>Pela integração simples de Monte Carlo, podemos facilmente obter esta estimativa:</p>
<pre class="r"><code>a &lt;- 9.39; b &lt;- 33.67
m &lt;- 10000
x &lt;- runif(m, 0.3, 0.5)
## Calcula g(x)
theta.hat &lt;- dbeta(x, a, b)
## Calcula a média
(m.theta.hat &lt;- (sum(theta.hat)/m) * (0.5 - 0.3))</code></pre>
<pre><code># [1] 0.1014207</code></pre>
<pre class="r"><code>## Solução analítica
pbeta(0.5, a, b) - pbeta(0.3, a, b)</code></pre>
<pre><code># [1] 0.1018369</code></pre>
<p>No caso da Beta, calcular probabilidades do tipo <span class="math inline">\(P[X&gt;0.2]\)</span>, por exemplo, é mais fácil, pois sabemos que o domínio da Beta está no intervalo <span class="math inline">\((0,1)\)</span>. Portanto, os limites de integração são definidos <span class="math display">\[
P[X &gt; 0.2] = \int_{0.2}^{1}
\frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)} x^a (1-x)^{b} dx
\]</span> Assim, podemos fazer</p>
<pre class="r"><code>m &lt;- 10000
x &lt;- runif(m, 0.2, 1)
## Calcula g(x)
theta.hat &lt;- dbeta(x, a, b)
## Calcula a média
(m.theta.hat &lt;- (sum(theta.hat)/m) * (1 - 0.2))</code></pre>
<pre><code># [1] 0.585035</code></pre>
<pre class="r"><code>## Solução analítica
pbeta(0.2, a, b, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.5876479</code></pre>
</div>
</div>
</div>
<div id="distribuições-aproximadas" class="section level1">
<h1><span class="header-section-number">2</span> Distribuições aproximadas</h1>
<p>Note que nos dois exemplos acima, para cada problema de cálculo de probabilidades (integrais), precisamos aplicar o método de Monte Carlo.</p>
<p>No entanto, suponha que precisamos fazer diversos cálculos sob uma determinada VA. Ao invés de aplicar esse método para cada cálculo, podemos pensar que seria mais fácil se pudessemos obter uma <strong>amostra</strong> da distribuição de interesse. A partir desta <strong>distribuição</strong>, qualquer cálculo necessário pode ser derivado facilmente.</p>
<p>Essa é a ideia dos métodos a seguir. O primeiro deles, a amostragem por <strong>aceitação-rejeição</strong> já foi visto no contexto de geração de números aleatórios. A mesma ideia será usada aqui, mas agora <strong>usaremos a amostra gerada da distribuição de interesse para resolver problemas de integração</strong>.</p>
<p>O segundo método, o de <strong>re-amostragem por importância</strong>, pode ser visto como uma extensão do método de amostragem por importância, que vimos no contexto de generalização do método simples de integração de Monte Carlo. Nesse caso, usaremos as mesmas ideias para <strong>gerar uma amostra da distribuição de interesse</strong>, e não apenas resolver uma integral.</p>
<div id="amostragem-por-rejeição" class="section level2">
<h2><span class="header-section-number">2.1</span> Amostragem por rejeição</h2>
<p>A ideia inicial do método é exatamente <strong>igual ao que já foi visto anteriormente</strong> no contexto de geração de números aleatórios de uma distribuição alvo <span class="math inline">\(f\)</span>.</p>
<p>O seguinte algoritmo permite gerar números aleatórios de uma distribuição de probabilidade caracterizada pela função densidade <span class="math inline">\(f\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Gerar <span class="math inline">\(y\)</span> como sendo uma ocorrência da variável aleatória proveniente de uma distribuição com densidade <span class="math inline">\(g\)</span>, que “encapsula” a distribuição de <span class="math inline">\(f\)</span>.</li>
<li>Gerar <span class="math inline">\(u\)</span> como sendo uma ocorrência de uma uniforme padrão.</li>
<li>Se <span class="math display">\[
u \leq \frac{f(y)}{M g(y)}
\]</span> considerar que <span class="math inline">\(x = y\)</span> é um valor da distribuição de probabilidade alvo cuja densidade é <span class="math inline">\(f\)</span>, caso contrário, descartar <span class="math inline">\(y\)</span>.</li>
<li>Repetir até atingir o número de valores desejado <span class="math inline">\(n\)</span>.</li>
</ol>
<p>Para determinar o valor de <span class="math inline">\(M\)</span>, basta seguir a seguinte relação</p>
<p><span class="math display">\[
M \geq \max_x \frac{f(x)}{g(x)}
\]</span></p>
<div id="exemplo-exponencial-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Exemplo (exponencial)</h3>
<p>Suponha novamente que queremos obter a integral</p>
<p><span class="math display">\[
\theta = \int_2^4 e^{-x} dx
\]</span></p>
<p>Sabemos que a função acima é uma <span class="math inline">\(\text{Exp(1)}\)</span>. Ao invés de usar o método de integração de Monte Carlo, vamos <strong>obter uma amostra desta distribuição</strong>, e, com ela, calcularemos a integral desejada.</p>
<p>Por simplificação, usaremos como distribuição proposta uma <span class="math inline">\(\text{Exp}(0.5)\)</span>. Nesse caso, obtemos o valor de <span class="math inline">\(M\)</span> como</p>
<pre class="r"><code>(M &lt;- optimize(f = function(x) {dexp(x, 1)/dexp(x, .5)},
               interval = c(0, 50), maximum = TRUE)$objective)</code></pre>
<pre><code># [1] 1.99993</code></pre>
<pre class="r"><code>curve(dexp(x, 1), from = 0, to = 10, col = 4, ylim = c(0, 1))
curve(dexp(x, 0.5), from = 0, to = 10, add = TRUE, lty = 2)
curve(M * dexp(x, .5), add = TRUE, lty = 2, lwd = 2)
legend(&quot;topright&quot;, legend = c(&quot;f(x)&quot;, &quot;g(x)&quot;, &quot;M g(x)&quot;),
       lty = c(1, 2, 2), col = c(4, 1, 1), lwd = c(1, 1, 2), bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Agora podemos prosseguir com o algoritmo da seguinte forma:</p>
<pre class="r"><code>## Criando os elementos necessários
f &lt;- function(x) dexp(x, 1)
g &lt;- function(x) dexp(x, 0.5)
## Simula valores de f
N &lt;- 1e5
x &lt;- numeric(N)
i &lt;- 1
while(i &lt;= N) {
    y &lt;- rexp(1, 0.5)
    u &lt;- runif(1)
    r &lt;- f(y)/(M * g(y))
    if(u &lt; r) {
        x[i] &lt;- y
        i &lt;- i + 1
    }
}
## Tamanho da amostra
length(x)</code></pre>
<pre><code># [1] 100000</code></pre>
<pre class="r"><code>## Visualização da amostra
par(mfrow = c(1, 2))
hist(x, freq = FALSE, ylim = c(0, 1))
curve(dexp(x, 1), add = TRUE, from = 0, to = 10, col = 2)
plot(ecdf(x))
curve(pexp(x, 1), add = TRUE, from = 0, to = 10, col = 2)
legend(&quot;right&quot;, legend = c(&quot;Empírica&quot;, &quot;Teórica&quot;),
       lty = 1, col = 1:2, bty = &quot;n&quot;)
par(mfrow = c(1, 1))</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Como agora temos a distribuição completa da <span class="math inline">\(\text{Exp}(1)\)</span>, podemos obter qualquer probabilidade (ou integral) aproximada, simplesmente através das contagens de valores no intervalo especificado. Note que a integral da distribuição, ou seja, <span class="math inline">\(\int_0^{\infty} f(x) dx\)</span> deve fechar em <strong>aproximadamente</strong> 1:</p>
<pre class="r"><code>sum(x &gt; 0 &amp; x &lt;= max(x))/N</code></pre>
<pre><code># [1] 1</code></pre>
<p>Agora, por exemplo, a <span class="math inline">\(P[2&lt;X&lt;4]\)</span> pode ser calculada como</p>
<pre class="r"><code>## Probabilidade empírica
sum(x &gt;= 2 &amp; x &lt;= 4)/N</code></pre>
<pre><code># [1] 0.117</code></pre>
<pre class="r"><code>## Teórica
pexp(4, 1) - pexp(2, 1)</code></pre>
<pre><code># [1] 0.1170196</code></pre>
<p>Agora se quisermos calcular <span class="math inline">\(P[X&gt;2]\)</span>, temos condições de fazer através de</p>
<pre class="r"><code>## Probabilidade empírica
sum(x &gt;= 2)/N</code></pre>
<pre><code># [1] 0.13488</code></pre>
<pre class="r"><code>## Teórica
pexp(2, 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.1353353</code></pre>
<p>De maneira geral, dessa forma, qualquer probabilidade pode ser calculada como mostrado acima. Matematicamente, podemos representar esse processo por</p>
<p><span class="math display">\[
P[X \leq x] = \frac{1}{m} \sum_{i=1}^m I(X \leq x)
\]</span> onde <span class="math display">\[
I(X \leq x) =
\begin{cases}
1, &amp; \text{se } X \leq x \\
0, &amp; \text{caso contrário}
\end{cases}
\]</span> é uma função indicadora. Note que isso se extende para qualquer outro tipo de probabilidade, e.g. <span class="math inline">\(P[X &gt; x]\)</span>, etc.</p>
</div>
<div id="exemplo-beta-1" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Exemplo (beta)</h3>
<p>Voltando ao exemplo de <span class="math inline">\(X \sim \text{Beta}(a=9.39, b=33.67)\)</span>, queremos calcular <span class="math inline">\(P[0.3 &lt; X &lt; 0.5]\)</span>, mas agora através da obtenção de uma <strong>amostra completa desta distribuição</strong>.</p>
<p>Usando o método de aceitação-rejeição, vamos usar como distribuição proposta uma <span class="math inline">\(\text{U}(0,1)\)</span>. Portanto:</p>
<pre class="r"><code>a &lt;- 9.39; b &lt;- 33.67
(M &lt;- optimize(f = function(x) {dbeta(x, a, b)/dunif(x)},
               interval = c(0, 1), maximum = TRUE)$objective)</code></pre>
<pre><code># [1] 6.426808</code></pre>
<pre class="r"><code>curve(dbeta(x, a, b), from = 0, to = 1, col = 4, ylim = c(0, 7))
curve(dunif(x), from = 0, to = 1, add = TRUE, lty = 2)
curve(M * dunif(x), add = TRUE, lty = 2, lwd = 2)
legend(&quot;right&quot;, legend = c(&quot;f(x)&quot;, &quot;g(x)&quot;, &quot;M g(x)&quot;),
       lty = c(1, 2, 2), col = c(4, 1, 1), lwd = c(1, 1, 2), bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Seguindo o mesmo algoritmo anterior, temos então:</p>
<pre class="r"><code>## Criando os elementos necessários
f &lt;- function(x, a, b) dbeta(x, a, b)
g &lt;- function(x) dunif(x)
## Simula valores de f
N &lt;- 1e5
x &lt;- numeric(N)
i &lt;- 1
while(i &lt;= N) {
    y &lt;- runif(1)
    u &lt;- runif(1)
    r &lt;- f(y, a, b)/(M * g(y))
    if(u &lt; r) {
        x[i] &lt;- y
        i &lt;- i + 1
    }
}
## Tamanho da amostra
length(x)</code></pre>
<pre><code># [1] 100000</code></pre>
<pre class="r"><code>## Integral
sum(x &gt;= 0 &amp; x &lt;= 1)/N</code></pre>
<pre><code># [1] 1</code></pre>
<pre class="r"><code>## Visualização da amostra
par(mfrow = c(1, 2))
hist(x, freq = FALSE,  ylim = c(0, 7))
curve(dbeta(x, a,  b), add = TRUE, from = 0, to = 1, col = 2)
plot(ecdf(x))
curve(pbeta(x, a,  b), add = TRUE, from = 0, to = 1, col = 2)
legend(&quot;right&quot;, legend = c(&quot;Empírica&quot;, &quot;Teórica&quot;),
       lty = 1, col = 1:2, bty = &quot;n&quot;)
par(mfrow = c(1, 1))</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Agora, podemos calcular qualquer probabilidade. Por exemplo:</p>
<pre class="r"><code>## P[0.3 &lt; X &lt; 0.5]
sum(x &gt; 0.3 &amp; x &lt; 0.5)/N</code></pre>
<pre><code># [1] 0.10234</code></pre>
<pre class="r"><code>pbeta(0.5, a, b) - pbeta(0.3, a, b)</code></pre>
<pre><code># [1] 0.1018369</code></pre>
<pre class="r"><code>## P[X &gt; 0.2]
sum(x &gt; 0.2)/N</code></pre>
<pre><code># [1] 0.58714</code></pre>
<pre class="r"><code>pbeta(0.2, a, b, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.5876479</code></pre>
</div>
</div>
<div id="re-amostragem-por-importância" class="section level2">
<h2><span class="header-section-number">2.2</span> Re-amostragem por importância</h2>
<p>O método de re-amostragem por importância (SIR - <em>Sampling Importance Resampling</em>) é uma alternativa ao método de aceitação-rejeição <strong>quando não é possível determinar um valor razoável para</strong> <span class="math inline">\(M\)</span>. A essência do algoritmo é amostrar valores segundo pesos que são computados para cada um deles.</p>
<p>Veremos que o método nada mais é do que uma <strong>extensão do método de amostragem por importância para aproximação de integrais</strong>. No entanto, o objetivo aqui também é obter a distribuição completa da densidade alvo, e, com isso, calcular quantidades de interesse.</p>
<p>O método de re-amostragem por importância é também muito utilizado no contexto de <strong>inferência bayesiana</strong>, na obtenção de distribuições posteriores de parâmetros.</p>
<p>Lembrando que, na <strong>amsotrgem por importância</strong>, temos o seguinte cenário. Suponha que <span class="math inline">\(X\)</span> seja uma VA com densidade <span class="math inline">\(f(x)\)</span>. Seja <span class="math inline">\(Y = g(X)/f(X)\)</span>, então <span class="math display">\[
\int g(x) dx = \int \frac{g(x)}{f(x)} f(x) dx = \text{E}[Y]
\]</span> Com isso, podemos estimar <span class="math inline">\(\text{E}[Y]\)</span> como uma integração simples de Monte Carlo, ou seja, <span class="math display">\[
\frac{1}{m}\sum_{i=1}^{m} Y_i = \frac{1}{m}\sum_{i=1}^{m}
\frac{g(X_i)}{f(X_i)}
\]</span> onde as VAs <span class="math inline">\(X_1, \ldots, X_m\)</span> são geradas a partir da distribuição de <span class="math inline">\(f(x)\)</span>. A função <span class="math inline">\(f(x)\)</span> é chamada de <strong>função de importância</strong>.</p>
<p>O algoritmo para o método de <strong>amostragem por importância</strong> é o seguinte:</p>
<ol style="list-style-type: decimal">
<li>Gerar uma amostra de <span class="math inline">\(m\)</span> observações independentes da função de importância <span class="math inline">\(f(x)\)</span>, <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>.</li>
<li>Calcular a razão entre <span class="math inline">\(g(x)\)</span> e <span class="math inline">\(f(x)\)</span> e determinar a média <span class="math inline">\(\frac{1}{m}\sum_{i=1}^{m} \frac{g(x_i)}{f(x_i)}\)</span></li>
</ol>
<p>A média fornece diretamente uma estimativa de integral requerida.</p>
<div class="panel panel-primary">
<div class="panel-heading">
Aproximando uma integral indefinida pela amostragem por importância
</div>
<div class="panel-body">
<p>Voltando brevemente ao caso da exponencial, pela amostragem por importância, podemos agora obter uma estimativa de <span class="math inline">\(P[X &gt; 2]\)</span>, caso que não conseguimos usando a integração simples de Monte Carlo.</p>
<pre class="r"><code>## Define funções
g &lt;- function(x) exp(-x) * (x &gt;= 2)
f &lt;- function(x) dexp(x, 0.5) # Proposta é Exp(0.5)
## 1. Amostra da proposta
m &lt;- 1e5
x &lt;- rexp(m, 0.5)
## 2. Calcula a média da razão
mean(g(x)/f(x))</code></pre>
<pre><code># [1] 0.1358222</code></pre>
<pre class="r"><code>## Teórico
pexp(2, 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.1353353</code></pre>
</div>
</div>
<p>O algoritmo do método de <strong>re-amostragem por importância</strong> é uma extensão do algoritmo anterior e consiste nos seguintes passos:</p>
<ol style="list-style-type: decimal">
<li>(<strong>Amostragem</strong>) Gerar uma amostra de <span class="math inline">\(m\)</span> observações independentes da função de importância <span class="math inline">\(f(x)\)</span>, <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>.</li>
<li>Calcular os <strong>pesos</strong> <span class="math display">\[
w(x_i) = \frac{g(x_i)}{f(x_i)}
\]</span> Os pesos dão uma ideia da probabilidade de aceitação de um determinado <span class="math inline">\(x_i\)</span>. Como estes pesos podem ser maiores do que 1, eles precisam ser padronizados por <span class="math display">\[
w^*(x_i) = \frac{w(x_i)}{\sum_{i=1}^m w(x_i)}
\]</span></li>
<li>(<strong>Re-amostragem por importância</strong>) Amostrar <strong>com reposição</strong> <span class="math inline">\(k &lt; m\)</span> valores de <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>, utilizando os pesos <span class="math inline">\(\{w^*(x_1), \ldots, w^*(x_m)\}\)</span>, como uma <strong>distribuição discreta de probabilidades</strong>.</li>
</ol>
<p>Dessa forma, <span class="math inline">\(\mathcal{X} = \{x^*_1, \ldots, x^*_k\}\)</span> será uma amostra de <span class="math inline">\(g(X)\)</span>.</p>
<div id="exemplo-exponencial-2" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Exemplo (exponencial)</h3>
<p>Seguindo com o exemplo da <span class="math inline">\(\text{Exp}(1)\)</span>, o código abaixo serve para gerar uma amostra por importância desta distribuição.</p>
<p>A função de importância considerada aqui é uma <span class="math inline">\(\text{Exp}(0.5)\)</span>. Lembre-se que nesse caso, <strong>não é necessário que a função proposta seja maior do que a função alvo</strong>.</p>
<pre class="r"><code>curve(dexp(x, 1), from = 0, to = 10, col = 4)
curve(dexp(x,  0.5), from = 0, to = 10, add = TRUE, lty = 2)
legend(&quot;right&quot;, legend = c(&quot;g(x)&quot;, &quot;f(x)&quot;),
       lty = c(1, 2), col = c(4, 1), bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Define funções
g &lt;- function(x) exp(-x) * (x &gt;= 0)
f &lt;- function(x) dexp(x, 0.5)
## 1. Amostragem
m &lt;- 1e5
x &lt;- rexp(m, 0.5)
## 2. Calcula pesos
w &lt;- g(x)/f(x)
w.norm &lt;- w/sum(w)
## 3. Re-amostragem por importância
k &lt;- 1e4
## Amostra considerando os pesos normalizados para cada X
g.sample &lt;- sample(x, size = k, replace = TRUE, prob = w.norm)
## Tamanho da amostra
length(g.sample)</code></pre>
<pre><code># [1] 10000</code></pre>
<pre class="r"><code>## Integral
sum(g.sample &gt; 0 &amp; g.sample &lt; max(g.sample))/k</code></pre>
<pre><code># [1] 0.9999</code></pre>
<pre class="r"><code>## Visualização da amostra
par(mfrow = c(1, 2))
hist(g.sample, freq = FALSE)
curve(dexp(x, 1), add = TRUE, from = 0, to = 10, col = 2)
plot(ecdf(g.sample))
curve(pexp(x, 1), add = TRUE, from = 0, to = 10, col = 2)
legend(&quot;right&quot;, legend = c(&quot;Empírica&quot;, &quot;Teórica&quot;),
       lty = 1, col = 1:2, bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-19-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))</code></pre>
<p>É possível ver porque o método funciona quando vemos um gráfico dos valoreas amostrados de <span class="math inline">\(X\)</span> com seus respectivos pesos:</p>
<pre class="r"><code>curve(dexp(x, 1), from = 0, to = 10, col = 4,  ylim = c(0, 2))
curve(dexp(x,  0.5), from = 0, to = 10, add = TRUE, lty = 2)
legend(&quot;right&quot;, legend = c(&quot;f(x)&quot;, &quot;g(x)&quot;),
       lty = c(1, 2), col = c(4, 1), bty = &quot;n&quot;)
points(x, w)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Com uma amostra completa da distribuição, podemos então calcular qualquer tipo de probabilidades:</p>
<pre class="r"><code>## P[2 &lt; X &lt; 4]
sum(g.sample &gt;= 2 &amp; g.sample &lt;= 4)/k</code></pre>
<pre><code># [1] 0.1204</code></pre>
<pre class="r"><code>## Teórica
pexp(4, 1) - pexp(2, 1)</code></pre>
<pre><code># [1] 0.1170196</code></pre>
<pre class="r"><code>## P[X &gt; 2]
sum(g.sample &gt; 2)/k</code></pre>
<pre><code># [1] 0.1361</code></pre>
<pre class="r"><code>pexp(2, 1, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.1353353</code></pre>
</div>
<div id="exemplo-beta-2" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Exemplo (beta)</h3>
<p>Voltando ao exemplo de <span class="math inline">\(X \sim \text{Beta}(a=9.39, b=33.67)\)</span>, vamos ober uma amostra desta distribuição pelo método de re-amostragem por importância. Aqui também utilizaremos uma <span class="math inline">\(\text{U}(0,1)\)</span> como função de importância.</p>
<pre class="r"><code>a &lt;- 9.39; b &lt;- 33.67
curve(dbeta(x, a,  b), from = 0, to = 1, col = 4)
curve(dunif(x, 0, 1), from = 0, to = 1, add = TRUE, lty = 2)
legend(&quot;right&quot;, legend = c(&quot;g(x)&quot;, &quot;f(x)&quot;),
       lty = c(1, 2), col = c(4, 1), bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-23-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Define funções
g &lt;- function(x, a, b) dbeta(x, a, b)
f &lt;- function(x) dunif(x) # usando U(0,1)
## 1. Amostragem
m &lt;- 1e5
x &lt;- runif(m)
## 2. Calcula pesos
w &lt;- g(x, a, b)/f(x)
w.norm &lt;- w/sum(w)
## 3. Re-amostragem por importância
k &lt;- 1e4
## Amostra considerando os pesos normalizados para cada X
g.sample &lt;- sample(x, size = k, replace = TRUE, prob = w.norm)
## Tamanho da amostra
length(g.sample)</code></pre>
<pre><code># [1] 10000</code></pre>
<pre class="r"><code>## Integral
sum(g.sample &gt; 0 &amp; g.sample &lt; 1)/k</code></pre>
<pre><code># [1] 1</code></pre>
<pre class="r"><code>## Visualização da amostra
par(mfrow = c(1, 2))
hist(g.sample, freq = FALSE,  ylim = c(0, 7))
curve(dbeta(x, a,  b), add = TRUE, from = 0, to = 1, col = 2)
plot(ecdf(g.sample))
curve(pbeta(x, a, b), add = TRUE, from = 0, to = 1, col = 2)
legend(&quot;right&quot;, legend = c(&quot;Empírica&quot;, &quot;Teórica&quot;),
       lty = 1, col = 1:2, bty = &quot;n&quot;)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))</code></pre>
<p>Novamente podemos conferir a relação entre os valores amostrados de <span class="math inline">\(X\)</span> e seus respectivos pesos calculados:</p>
<pre class="r"><code>a &lt;- 9.39; b &lt;- 33.67
curve(dbeta(x, a,  b), from = 0, to = 1, col = 4)
curve(dunif(x, 0, 1), from = 0, to = 1, add = TRUE, lty = 2)
legend(&quot;right&quot;, legend = c(&quot;f(x)&quot;, &quot;g(x)&quot;),
       lty = c(1, 2), col = c(4, 1), bty = &quot;n&quot;)
points(x, w)</code></pre>
<p><img src="figures/07_MC_aprox/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Calcula probabilidades:</p>
<pre class="r"><code>## P[0.3 &lt; X &lt; 0.5]
sum(g.sample &gt; 0.3 &amp; g.sample &lt; 0.5)/k</code></pre>
<pre><code># [1] 0.102</code></pre>
<pre class="r"><code>pbeta(0.5, a, b) - pbeta(0.3, a, b)</code></pre>
<pre><code># [1] 0.1018369</code></pre>
<pre class="r"><code>## P[X &gt; 0.2]
sum(g.sample &gt; 0.2)/k</code></pre>
<pre><code># [1] 0.584</code></pre>
<pre class="r"><code>pbeta(0.2, a, b, lower.tail = FALSE)</code></pre>
<pre><code># [1] 0.5876479</code></pre>
<p>A obtenção de uma amostra da distribuição completa da VA de interesse possui diversas finalidades. Por exemplo, no caso da beta, podemos obter um resumo</p>
<pre class="r"><code>summary(g.sample)</code></pre>
<pre><code>#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.03969 0.17313 0.21344 0.21780 0.25754 0.50699</code></pre>
<p>ou, por exemplo, saber o intervalo onde se encontram 95% dos dados:</p>
<pre class="r"><code>quantile(g.sample, probs = c(.025, .975))</code></pre>
<pre><code>#      2.5%     97.5% 
# 0.1094833 0.3526790</code></pre>
<p>Esse tipo de resumo será utilizado nos métodos de inferência que veremos mais adiante.</p>
<p>No contexto de inferência bayesiana, as distribuições geradas por estes métodos se referem às <strong>distribuições posteriores dos parâmetros</strong> objetos da inferência. Dessa forma, o intervalo acima, por exemplo, nos forneceria diretamente um “intervalo de credibilidade” de 95% para os valores do parâmetro.</p>
</div>
</div>
</div>

<center>
  <hr width="100%" size="3px">
  <p> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.pt_BR">
      <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" alt="Licença Creative Commons 4.0"> </a>
  </p>
  <p> <font size="2"> Este conteúdo
      está disponível por meio da Licença Creative Commons 4.0 </font>
  </p>
</center>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
