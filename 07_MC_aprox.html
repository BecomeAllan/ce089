<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Fernando P. Mayer" />


<title>Métodos de Monte Carlo</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66454501-13"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-66454501-13');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CE089</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="aulas.html">Aulas</a>
</li>
<li>
  <a href="referencias.html">Referências</a>
</li>
<li>
  <a href="notas.html">Notas</a>
</li>
<li>
  <a href="materiais.html">Materiais</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leg-ufpr/ce089">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Métodos de Monte Carlo</h1>
<h3 class="subtitle">Distribuições aproximadas baseadas em simulação de Monte Carlo</h3>
<h4 class="author">Fernando P. Mayer</h4>

</div>


<!-- # Introdução -->
<!-- # Aproximação de $\pi$ -->
<!-- ## Método do círculo/quadrado -->
<!-- ## Agulha de Buffon -->
<div id="aproximação-de-integrais" class="section level1">
<h1><span class="header-section-number">1</span> Aproximação de integrais</h1>
<p>Já vimos que a integração de Monte Carlo serve para aproximar integrais de alta dimensão ou que não possuem solução fechada (analítica).</p>
<p>Agora veremos que a integração de Monte Carlo, naturalmente serve também para o cáculo de probabilidades entre algum intervalo, e.g., <span class="math inline">\(P[a &lt; X &lt; b]\)</span> ou <span class="math inline">\(P[X &gt; a]\)</span>, que nada mais são do que cálculos de áreas no intervalo especificado.</p>
<p>A integração de Monte Carlo nos fornece uma estimativa dessa integral, e, como vimos, o erro padrão dessa estimativa pode ser calculado, e intervalos de confiança podem ser obtidos devido à suposição de que assintoticamente a estimativa possui distribuição normal.</p>
<p>Agora, veremos que podemos obter essa mesma estimativa, mas de uma forma um pouco diferente: simulando a própria distribuição de interesse, e obtendo valores de áreas (integrais) usando a própria amostra. A vantagem é que, dessa forma, obtemos uma descrição mais completa do problema em questão, e, com isso, podemos obter outras medidas que forem necessárias, de uma única vez. Além disso, medidas de incerteza como erros-padrões e intervalos de confiança podem ser derivados a partir da própria distribuição amostral.</p>
<p>A obtenção de uma amostra da distribuição de interesse será fundamental para os métodos de inferência que veremos mais adiante. Além disso, estes métodos são utilizados como o “padrão” para a resolução de problemas em inferência bayesiana.</p>
<div id="integração-de-monte-carlo" class="section level2">
<h2><span class="header-section-number">1.1</span> Integração de Monte Carlo</h2>
<p>Como vimos, a integração <strong>simples</strong> de Monte Carlo é um algoritmo <strong>não sequencial</strong> (i.e., os valores amostrados são independentes) para aproximação de integrais do tipo <span class="math display">\[
\theta = \int_a^b g(x) dx
\]</span></p>
<p>através da relação</p>
<p><span class="math display">\[\begin{align*}
\theta &amp;= \int_a^b g(x) f(x) dx \\
  &amp;= (b-a) \int_a^b g(x) \frac{1}{b-a} dx \\
  &amp;= (b-a) \text{E}[g(X)]
\end{align*}\]</span></p>
<p>onde <span class="math inline">\(X \sim \text{U}(a, b)\)</span>.</p>
<p>De maneira geral, para calcular <span class="math inline">\(\theta = \int_a^b g(x) dx\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Gere <span class="math inline">\(X_1, \ldots, X_m\)</span> de <span class="math inline">\(U(a,b)\)</span></li>
<li>Calcule <span class="math inline">\(\overline{g(x)} = \frac{1}{m}\sum_{i=1}^{m} g(x_i)\)</span></li>
<li><span class="math inline">\(\hat\theta = (b-a)\overline{g(x)}\)</span></li>
</ol>
<div id="exemplo-exponencial" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Exemplo (exponencial)</h3>
<p>Para obter a estimativa de <span class="math display">\[
\theta = \int_0^1 e^{-x} dx
\]</span> fazemos:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co">## Obtem m valores da U(0,1)</span></a>
<a class="sourceLine" id="cb1-2" title="2">m &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb1-3" title="3">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">## Calcula g(x)</span></a>
<a class="sourceLine" id="cb1-5" title="5">theta.hat &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">## Calcula a média</span></a>
<a class="sourceLine" id="cb1-7" title="7">(m.theta.hat &lt;-<span class="st"> </span><span class="kw">sum</span>(theta.hat)<span class="op">/</span>m)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># [1] 0.6337583</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">## Solução analítica</span></a>
<a class="sourceLine" id="cb1-10" title="10">(theta &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># [1] 0.6321206</span></a></code></pre></div>
<p>Para obter a estimativa de <span class="math display">\[
\theta = \int_2^4 e^{-x} dx
\]</span> fazemos:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">## Obtem m valores da U(2,4)</span></a>
<a class="sourceLine" id="cb2-2" title="2">m &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb2-3" title="3">a &lt;-<span class="st"> </span><span class="dv">2</span>; b &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb2-4" title="4">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="dt">min =</span> a, <span class="dt">max =</span> b)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">## Calcula g(x)</span></a>
<a class="sourceLine" id="cb2-6" title="6">theta.hat &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">## Calcula a média * (b - a)</span></a>
<a class="sourceLine" id="cb2-8" title="8">(m.theta.hat &lt;-<span class="st"> </span>(<span class="kw">sum</span>(theta.hat)<span class="op">/</span>m) <span class="op">*</span><span class="st"> </span>(b <span class="op">-</span><span class="st"> </span>a))</a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># [1] 0.1167288</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">## Solução analítica</span></a>
<a class="sourceLine" id="cb2-11" title="11">(theta &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">4</span>))</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co"># [1] 0.1170196</span></a></code></pre></div>
<p>Vemos que, nos dois casos acima, estamos na verdade obtendo uma estimativa das probabilidades <span class="math inline">\(P[0&lt;X&lt;1]\)</span> e <span class="math inline">\(P[2&lt;X&lt;4]\)</span>, respectivamente.</p>
<p>No entanto, se quisermos calcular a seguinte probabilidade <span class="math display">\[
P[X&gt;2] = \int_2^{\infty} e^{-x} dx
\]</span></p>
<p>Nesse caso, a integração simples de Monte Carlo não é útil, pois não é possível que o limite de integração seja indefinido.</p>
<p>Na verdade, podemos pensar em uma aproximação <strong>grosseira</strong>, supondo que vamos amostrar de <span class="math inline">\(X \sim \text{U}(2, \infty)\)</span>, onde podemos aproximar o valor de <span class="math inline">\(\infty\)</span> por um número grande. Por exemplo:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">## Obtem m valores da U(2,Inf)</span></a>
<a class="sourceLine" id="cb3-2" title="2">m &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb3-3" title="3">a &lt;-<span class="st"> </span><span class="dv">2</span>; b &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb3-4" title="4">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="dt">min =</span> a, <span class="dt">max =</span> b)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">## Calcula g(x)</span></a>
<a class="sourceLine" id="cb3-6" title="6">theta.hat &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x)</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">## Calcula a média * (b - a)</span></a>
<a class="sourceLine" id="cb3-8" title="8">(m.theta.hat &lt;-<span class="st"> </span>(<span class="kw">sum</span>(theta.hat)<span class="op">/</span>m) <span class="op">*</span><span class="st"> </span>(b <span class="op">-</span><span class="st"> </span>a))</a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># [1] 0.2770476</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">## Solução analítica</span></a>
<a class="sourceLine" id="cb3-11" title="11">(theta &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">1e5</span>))</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co"># [1] 0.1353353</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">## Usando a exponencial</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co"># [1] 0.1353353</span></a></code></pre></div>
<p>Note que o valor estimado nesse caso está longe do velor correto, pois estamos adotando um procedimento completamente arbitrário.</p>
</div>
<div id="exemplo-beta" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Exemplo (beta)</h3>
<p>Considere que uma VA <span class="math inline">\(X\)</span> tem distribuição <span class="math inline">\(\text{Beta}(a=9.39, b=33.67)\)</span>, e queremos obter <span class="math inline">\(P[0.3 &lt; X &lt; 0.5]\)</span>, ou seja,</p>
<p><span class="math display">\[
P[0.3 &lt; X &lt; 0.5] = \int_{0.3}^{0.5}
\frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)} x^a (1-x)^{b} dx
\]</span></p>
<p>Pela integração simples de Monte Carlo, podemos facilmente obter esta estimativa:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">a &lt;-<span class="st"> </span><span class="fl">9.39</span>; b &lt;-<span class="st"> </span><span class="fl">33.67</span></a>
<a class="sourceLine" id="cb4-2" title="2">m &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb4-3" title="3">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="fl">0.3</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">## Calcula g(x)</span></a>
<a class="sourceLine" id="cb4-5" title="5">theta.hat &lt;-<span class="st"> </span><span class="kw">dbeta</span>(x, a, b)</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">## Calcula a média</span></a>
<a class="sourceLine" id="cb4-7" title="7">(m.theta.hat &lt;-<span class="st"> </span>(<span class="kw">sum</span>(theta.hat)<span class="op">/</span>m) <span class="op">*</span><span class="st"> </span>(<span class="fl">0.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.3</span>))</a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># [1] 0.1014207</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">## Solução analítica</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">pbeta</span>(<span class="fl">0.5</span>, a, b) <span class="op">-</span><span class="st"> </span><span class="kw">pbeta</span>(<span class="fl">0.3</span>, a, b)</a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co"># [1] 0.1018369</span></a></code></pre></div>
<p>No caso da Beta, calcular probabilidades do tipo <span class="math inline">\(P[X&gt;0.2]\)</span>, por exemplo, é mais fácil, pois sabemos que o domínio da Beta está no intervalo <span class="math inline">\((0,1)\)</span>. Portanto, os limites de integração são definidos <span class="math display">\[
P[X &gt; 0.2] = \int_{0.2}^{1}
\frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)} x^a (1-x)^{b} dx
\]</span> Assim, podemos fazer</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">m &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb5-2" title="2">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="fl">0.2</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">## Calcula g(x)</span></a>
<a class="sourceLine" id="cb5-4" title="4">theta.hat &lt;-<span class="st"> </span><span class="kw">dbeta</span>(x, a, b)</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">## Calcula a média</span></a>
<a class="sourceLine" id="cb5-6" title="6">(m.theta.hat &lt;-<span class="st"> </span>(<span class="kw">sum</span>(theta.hat)<span class="op">/</span>m) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co"># [1] 0.585035</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">## Solução analítica</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="kw">pbeta</span>(<span class="fl">0.2</span>, a, b, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co"># [1] 0.5876479</span></a></code></pre></div>
</div>
</div>
</div>
<div id="distribuições-aproximadas" class="section level1">
<h1><span class="header-section-number">2</span> Distribuições aproximadas</h1>
<p>Note que nos dois exemplos acima, para cada problema de cálculo de probabilidades (integrais), precisamos aplicar o método de Monte Carlo.</p>
<p>No entanto, suponha que precisamos fazer diversos cálculos sob uma determinada VA. Ao invés de aplicar esse método para cada cálculo, podemos pensar que seria mais fácil se pudessemos obter uma amostra da distribuição de interesse. A partir desta distribuição, qualquer cálculo necessário pode ser derivado facilmente.</p>
<p>Essa é a ideia dos métodos a seguir. O primeiro deles, a amostragem por aceitação-rejeição já foi visto no contexto de geração de números aleatórios. A mesma ideia será usada aqui, mas agora usaremos a amostra gerada da distribuição de interesse para resolver problemas de integração.</p>
<p>O segundo método, o de re-amostragem por importância, pode ser visto como uma extensão do método de amostragem por importância, que vimos no contexto de generalização do método simples de integração de Monte Carlo. Nesse caso, usaremos as mesmas ideias para gerar uma amostra da distribuição de interesse, e não apenas resolver uma integral.</p>
<div id="amostragem-por-rejeição" class="section level2">
<h2><span class="header-section-number">2.1</span> Amostragem por rejeição</h2>
<p>A ideia inicial do método é exatamente igual ao que já foi visto anteriormente no contexto de geração de números aleatórios de uma distribuição alvo <span class="math inline">\(f\)</span>.</p>
<p>O seguinte algoritmo permite gerar números aleatórios de uma distribuição de probabilidade caracterizada pela função densidade <span class="math inline">\(f\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Gerar <span class="math inline">\(y\)</span> como sendo uma ocorrência da variável aleatória proveniente de uma distribuição com densidade <span class="math inline">\(g\)</span>, que “encapsula” a distribuição de <span class="math inline">\(f\)</span>.</li>
<li>Gerar <span class="math inline">\(u\)</span> como sendo uma ocorrência de uma uniforme padrão.</li>
<li>Se <span class="math display">\[
u \leq \frac{f(y)}{M g(y)}
\]</span> considerar que <span class="math inline">\(x = y\)</span> é um valor da distribuição de probabilidade alvo cuja densidade é <span class="math inline">\(f\)</span>, caso contrário, descartar <span class="math inline">\(y\)</span>.</li>
<li>Repetir até atingir o número de valores desejado <span class="math inline">\(n\)</span>.</li>
</ol>
<p>Para determinar o valor de <span class="math inline">\(M\)</span>, basta seguir a seguinte relação</p>
<p><span class="math display">\[
M \geq \max_x \frac{f(x)}{g(x)}
\]</span></p>
<div id="exemplo-exponencial-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Exemplo (exponencial)</h3>
<p>Suponha novamente que queremos obter a integral</p>
<p><span class="math display">\[
\theta = \int_2^4 e^{-x} dx
\]</span></p>
<p>Sabemos que a função acima é uma <span class="math inline">\(\text{Exp(1)}\)</span>. Ao invés de usar o método de integração de Monte Carlo, vamos obter uma amostra desta distribuição, e, com ela, calcularemos a integral desejada.</p>
<p>Por simplificação, usaremos como distribuição proposta uma <span class="math inline">\(\text{Exp}(0.5)\)</span>. Nesse caso, obtemos o valor de <span class="math inline">\(M\)</span> como</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">(M &lt;-<span class="st"> </span><span class="kw">optimize</span>(<span class="dt">f =</span> <span class="cf">function</span>(x) {<span class="kw">dexp</span>(x, <span class="dv">1</span>)<span class="op">/</span><span class="kw">dexp</span>(x, <span class="fl">.5</span>)},</a>
<a class="sourceLine" id="cb6-2" title="2">               <span class="dt">interval =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">maximum =</span> <span class="ot">TRUE</span>)<span class="op">$</span>objective)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co"># [1] 1.99993</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">curve</span>(<span class="kw">dexp</span>(x, <span class="dv">1</span>), <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">curve</span>(<span class="kw">dexp</span>(x, <span class="fl">0.5</span>), <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">curve</span>(M <span class="op">*</span><span class="st"> </span><span class="kw">dexp</span>(x, <span class="fl">.5</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;f(x)&quot;</span>, <span class="st">&quot;g(x)&quot;</span>, <span class="st">&quot;M g(x)&quot;</span>),</a>
<a class="sourceLine" id="cb7-5" title="5">       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Agora podemos prosseguir com o algoritmo da seguinte forma:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">## Criando os elementos necessários</span></a>
<a class="sourceLine" id="cb8-2" title="2">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dexp</span>(x, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">g &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dexp</span>(x, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">## Simula valores de f</span></a>
<a class="sourceLine" id="cb8-5" title="5">N &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb8-6" title="6">x &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</a>
<a class="sourceLine" id="cb8-7" title="7">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-8" title="8">j &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="cf">while</span>(i <span class="op">&lt;=</span><span class="st"> </span>N) {</a>
<a class="sourceLine" id="cb8-10" title="10">    y &lt;-<span class="st"> </span><span class="kw">rexp</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb8-11" title="11">    u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-12" title="12">    r &lt;-<span class="st"> </span><span class="kw">f</span>(y)<span class="op">/</span>(M <span class="op">*</span><span class="st"> </span><span class="kw">g</span>(y))</a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="cf">if</span>(u <span class="op">&lt;</span><span class="st"> </span>r) {</a>
<a class="sourceLine" id="cb8-14" title="14">        x[i] &lt;-<span class="st"> </span>y</a>
<a class="sourceLine" id="cb8-15" title="15">        i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-16" title="16">    }</a>
<a class="sourceLine" id="cb8-17" title="17">    j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-18" title="18">}</a>
<a class="sourceLine" id="cb8-19" title="19"><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co"># [1] 100000</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="kw">hist</span>(x, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb8-22" title="22"><span class="kw">curve</span>(<span class="kw">dexp</span>(x, <span class="dv">1</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Como agora temos a distribuição completa da <span class="math inline">\(\text{Exp}(1)\)</span>, podemos obter qualquer probabilidade (ou integral) aproximada, simplesmente através das contagens de valores no intervalo especificado. Note que a integral da distribuição, ou seja, <span class="math inline">\(\int_0^{\infty} f(x) dx\)</span> deve fechar em <strong>aproximadamente</strong> 1:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(x))<span class="op">/</span>N</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co"># [1] 1</span></a></code></pre></div>
<p>Agora, por exemplo, a <span class="math inline">\(P[2&lt;X&lt;4]\)</span> pode ser calculada como</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">## Probabilidade empírica</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">sum</span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>)<span class="op">/</span>N</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># [1] 0.117</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">## Teórica</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">pexp</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co"># [1] 0.1170196</span></a></code></pre></div>
<p>Agora se quisermos calcular <span class="math inline">\(P[X&gt;2]\)</span>, temos condições de fazer através de</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## Probabilidade empírica</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">sum</span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>)<span class="op">/</span>N</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co"># [1] 0.13488</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">## Teórica</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co"># [1] 0.1353353</span></a></code></pre></div>
<p>De maneira geral, dessa forma, qualquer probabilidade pode ser calculada como mostrado acima. Matematicamente, podemos representar esse processo por</p>
<p><span class="math display">\[
P[X \leq x] = \frac{1}{m} \sum_{i=1}^m I(X \leq x)
\]</span> onde <span class="math display">\[
I(X \leq x) =
\begin{cases}
1, &amp; \text{se } X \leq x \\
0, &amp; \text{caso contrário}
\end{cases}
\]</span> é uma função indicadora. Note que isso se extende para qualquer outro tipo de probabilidade, e.g. <span class="math inline">\(P[X &gt; x]\)</span>, etc.</p>
</div>
<div id="exemplo-beta-1" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Exemplo (beta)</h3>
<p>Voltando ao exemplo de <span class="math inline">\(X \sim \text{Beta}(a=9.39, b=33.67)\)</span>, queremos calcular <span class="math inline">\(P[0.3 &lt; X &lt; 0.5]\)</span>, mas agora através da obtenção de uma amostra completa desta distribuição.</p>
<p>Usando o método de aceitação-rejeição, vamos usar como distribuição proposta uma <span class="math inline">\(\text{U}(0,1)\)</span>. Portanto:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">a &lt;-<span class="st"> </span><span class="fl">9.39</span>; b &lt;-<span class="st"> </span><span class="fl">33.67</span></a>
<a class="sourceLine" id="cb12-2" title="2">(M &lt;-<span class="st"> </span><span class="kw">optimize</span>(<span class="dt">f =</span> <span class="cf">function</span>(x) {<span class="kw">dbeta</span>(x, a, b)<span class="op">/</span><span class="kw">dunif</span>(x)},</a>
<a class="sourceLine" id="cb12-3" title="3">               <span class="dt">interval =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">maximum =</span> <span class="ot">TRUE</span>)<span class="op">$</span>objective)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># [1] 6.426808</span></a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">curve</span>(<span class="kw">dbeta</span>(x, a, b), <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">curve</span>(<span class="kw">dunif</span>(x), <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">curve</span>(M <span class="op">*</span><span class="st"> </span><span class="kw">dunif</span>(x), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">legend</span>(<span class="st">&quot;right&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;f(x)&quot;</span>, <span class="st">&quot;g(x)&quot;</span>, <span class="st">&quot;M g(x)&quot;</span>),</a>
<a class="sourceLine" id="cb13-5" title="5">       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Seguindo o mesmo algoritmo anterior, temos então:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co">## Criando os elementos necessários</span></a>
<a class="sourceLine" id="cb14-2" title="2">f &lt;-<span class="st"> </span><span class="cf">function</span>(x, a, b) <span class="kw">dbeta</span>(x, a, b)</a>
<a class="sourceLine" id="cb14-3" title="3">g &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dunif</span>(x)</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">## Simula valores de f</span></a>
<a class="sourceLine" id="cb14-5" title="5">N &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb14-6" title="6">x &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</a>
<a class="sourceLine" id="cb14-7" title="7">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-8" title="8">j &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="cf">while</span>(i <span class="op">&lt;=</span><span class="st"> </span>N) {</a>
<a class="sourceLine" id="cb14-10" title="10">    y &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-11" title="11">    u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-12" title="12">    r &lt;-<span class="st"> </span><span class="kw">f</span>(y, a, b)<span class="op">/</span>(M <span class="op">*</span><span class="st"> </span><span class="kw">g</span>(y))</a>
<a class="sourceLine" id="cb14-13" title="13">    <span class="cf">if</span>(u <span class="op">&lt;</span><span class="st"> </span>r) {</a>
<a class="sourceLine" id="cb14-14" title="14">        x[i] &lt;-<span class="st"> </span>y</a>
<a class="sourceLine" id="cb14-15" title="15">        i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-16" title="16">    }</a>
<a class="sourceLine" id="cb14-17" title="17">    j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-18" title="18">}</a>
<a class="sourceLine" id="cb14-19" title="19"><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb14-20" title="20"><span class="co"># [1] 100000</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="kw">sum</span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>N</a>
<a class="sourceLine" id="cb14-22" title="22"><span class="co"># [1] 1</span></a>
<a class="sourceLine" id="cb14-23" title="23"><span class="kw">hist</span>(x, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb14-24" title="24"><span class="kw">curve</span>(<span class="kw">dbeta</span>(x, a, b), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Agora, podemos calcular qualquer probabilidade. Por exemplo:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co">## P[0.3 &lt; X &lt; 0.5]</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.3</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)<span class="op">/</span>N</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co"># [1] 0.10234</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">pbeta</span>(<span class="fl">0.5</span>, a, b) <span class="op">-</span><span class="st"> </span><span class="kw">pbeta</span>(<span class="fl">0.3</span>, a, b)</a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co"># [1] 0.1018369</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">## P[X &gt; 0.2]</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span>)<span class="op">/</span>N</a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co"># [1] 0.58714</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">pbeta</span>(<span class="fl">0.2</span>, a, b, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co"># [1] 0.5876479</span></a></code></pre></div>
</div>
</div>
<div id="re-amostragem-por-importância" class="section level2">
<h2><span class="header-section-number">2.2</span> Re-amostragem por importância</h2>
<p>O método de re-amostragem por importância (SIR - <em>Sampling Importance Resampling</em>) é uma alternativa ao método de aceitação-rejeição quando não é possível determinar um valor razoável para <span class="math inline">\(M\)</span>. A essência do algoritmo é amostrar valores segundo pesos que são computados para cada um deles.</p>
<p>Veremos que o método nada mais é do que uma extensão do método de amostragem por importância para aproximação de integrais. No entanto, o objetivo aqui também é obter a distribuição completa da densidade alvo, e, com isso, calcular quantidades de interesse.</p>
<p>O método de re-amostragem por importância é também muito utilizado no contexto de inferência bayesiana, na obtenção de distribuições posteriores de parâmetros.</p>
<p>Lembrando que, na amsotrgem por importância, temos o seguinte cenário. Suponha que <span class="math inline">\(X\)</span> seja uma VA com densidade <span class="math inline">\(f(x)\)</span>. Seja <span class="math inline">\(Y\)</span> a VA <span class="math inline">\(g(X)/f(X)\)</span>, então <span class="math display">\[
\int g(x) dx = \int \frac{g(x)}{f(x)} f(x) dx = \text{E}[Y]
\]</span> Com isso, podemos estimar <span class="math inline">\(\text{E}[Y]\)</span> como uma integração simples de Monte Carlo, ou seja, <span class="math display">\[
\frac{1}{m}\sum_{i=1}^{m} Y_i = \frac{1}{m}\sum_{i=1}^{m}
\frac{g(X_i)}{f(X_i)}
\]</span> onde as VAs <span class="math inline">\(X_1, \ldots, X_m\)</span> são geradas a partir da distribuição de <span class="math inline">\(f(x)\)</span>. A função <span class="math inline">\(f(x)\)</span> é chamada de <strong>função de importância</strong>.</p>
<p>O algoritmo para o método de <strong>amostragem por importância</strong> é o seguinte:</p>
<ol style="list-style-type: decimal">
<li>Gerar uma amostra de <span class="math inline">\(m\)</span> observações independentes da função de importância <span class="math inline">\(f(x)\)</span>, <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>.</li>
<li>Calcular a razão entre <span class="math inline">\(g(x)\)</span> e <span class="math inline">\(f(x)\)</span> e determinar a média <span class="math inline">\(\frac{1}{m}\sum_{i=1}^{m} \frac{g(x_i)}{f(x_i)}\)</span></li>
</ol>
<p>A média fornece diretamente uma estimativa de integral requerida.</p>
<div class="panel panel-primary">
<div class="panel-heading">
Aproximando uma integral indefinida pela amostragem por importância
</div>
<div class="panel-body">
<p>Voltando brevemente ao caso da exponencial, pela amostragem por importância, podemos agora obter uma estimativa de <span class="math inline">\(P[X &gt; 2]\)</span>, caso que não conseguimos usando a integração simples de Monte Carlo.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">## Define funções</span></a>
<a class="sourceLine" id="cb16-2" title="2">g &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">exp</span>(<span class="op">-</span>x) <span class="op">*</span><span class="st"> </span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dexp</span>(x, <span class="fl">0.5</span>) <span class="co"># Proposta é Exp(0.5)</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">## 1. Amostra da proposta</span></a>
<a class="sourceLine" id="cb16-5" title="5">m &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb16-6" title="6">x &lt;-<span class="st"> </span><span class="kw">rexp</span>(m, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">## 2. Calcula a média da razão</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">mean</span>(<span class="kw">g</span>(x)<span class="op">/</span><span class="kw">f</span>(x))</a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co"># [1] 0.1358222</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">## Teórico</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb16-12" title="12"><span class="co"># [1] 0.1353353</span></a></code></pre></div>
</div>
</div>
<p>O algoritmo do método de <strong>re-amostragem por importância</strong> é uma extensão do algoritmo anterior e consiste nos seguintes passos:</p>
<ol style="list-style-type: decimal">
<li>(<em>Amostragem</em>) Gerar uma amostra de <span class="math inline">\(m\)</span> observações independentes da função de importância <span class="math inline">\(f(x)\)</span>, <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>.</li>
<li>Calcular os <strong>pesos</strong> <span class="math display">\[
w(x_i) = \frac{g(x_i)}{f(x_i)}
\]</span> Os pesos dão uma ideia da probabilidade de aceitação de um determinado <span class="math inline">\(x_i\)</span>. Como estes pesos podem ser maiores do que 1, eles precisam ser padronizados por <span class="math display">\[
w^*(x_i) = \frac{w(x_i)}{\sum_{i=1}^m w(x_i)}
\]</span></li>
<li>(<em>Re-amostragem por importância</em>) Amostrar <strong>com reposição</strong> <span class="math inline">\(k &lt; m\)</span> valores de <span class="math inline">\(\{x_1, \ldots, x_m\}\)</span>, utilizando os pesos <span class="math inline">\(\{w^*(x_1), \ldots, w^*(x_m)\}\)</span>, como uma <strong>distribuição discreta de probabilidades</strong>.</li>
</ol>
<p>Dessa forma, <span class="math inline">\(\mathcal{X} = \{x^*_1, \ldots, x^*_k\}\)</span> será uma amostra de <span class="math inline">\(g(X)\)</span>.</p>
<div id="exemplo-exponencial-2" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Exemplo (exponencial)</h3>
<p>Seguindo com o exemplo da <span class="math inline">\(\text{Exp}(1)\)</span>, o código abaixo serve para gerar uma amostra por importância desta distribuição.</p>
<p>A função de importância considerada aqui é uma <span class="math inline">\(\text{Exp}(0.5)\)</span>. Lembre-se que nesse caso, não é necessário que a função proposta seja maior do que a função alvo.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co">## Define funções</span></a>
<a class="sourceLine" id="cb17-2" title="2">g &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">exp</span>(<span class="op">-</span>x) <span class="op">*</span><span class="st"> </span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb17-3" title="3">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dexp</span>(x, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co">## 1. Amostragem</span></a>
<a class="sourceLine" id="cb17-5" title="5">m &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb17-6" title="6">x &lt;-<span class="st"> </span><span class="kw">rexp</span>(m, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">## 2. Calcula pesos</span></a>
<a class="sourceLine" id="cb17-8" title="8">w &lt;-<span class="st"> </span><span class="kw">g</span>(x)<span class="op">/</span><span class="kw">f</span>(x)</a>
<a class="sourceLine" id="cb17-9" title="9">w.norm &lt;-<span class="st"> </span>w<span class="op">/</span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">## 3. Re-amostragem por importância</span></a>
<a class="sourceLine" id="cb17-11" title="11">k &lt;-<span class="st"> </span><span class="fl">1e4</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">## Amostra considerando os pesos normalizados para cada X</span></a>
<a class="sourceLine" id="cb17-13" title="13">g.sample &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dt">size =</span> k, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> w.norm)</a>
<a class="sourceLine" id="cb17-14" title="14"><span class="co">## Verifica a distribuição da amostra</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="kw">hist</span>(g.sample, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">curve</span>(<span class="kw">dexp</span>(x, <span class="dv">1</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>É possível ver porque o método funciona quando vemos um gráfico dos valoreas amostrados de <span class="math inline">\(X\)</span> com seus respectivos pesos:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">plot</span>(x, w.norm)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-19-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Com uma amostra completa da distribuição, podemos então calcular qualquer tipo de probabilidades:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co">## P[2 &lt; X &lt; 4]</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">sum</span>(g.sample <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>g.sample <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>)<span class="op">/</span>k</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="co"># [1] 0.1204</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">## Teórica</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="kw">pexp</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-6" title="6"><span class="co"># [1] 0.1170196</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co">## P[X &gt; 2]</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="kw">sum</span>(g.sample <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>)<span class="op">/</span>k</a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co"># [1] 0.1361</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="kw">pexp</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co"># [1] 0.1353353</span></a></code></pre></div>
</div>
<div id="exemplo-beta-2" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Exemplo (beta)</h3>
<p>Voltando ao exemplo de <span class="math inline">\(X \sim \text{Beta}(a=9.39, b=33.67)\)</span>, vamos ober uma amostra desta distribuição pelo método de re-amostragem por importância. Aqui também utilizaremos uma <span class="math inline">\(\text{U}(0,1)\)</span> como função de importância.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co">## Define funções</span></a>
<a class="sourceLine" id="cb20-2" title="2">a &lt;-<span class="st"> </span><span class="fl">9.39</span>; b &lt;-<span class="st"> </span><span class="fl">33.67</span></a>
<a class="sourceLine" id="cb20-3" title="3">g &lt;-<span class="st"> </span><span class="cf">function</span>(x, a, b) <span class="kw">dbeta</span>(x, a, b)</a>
<a class="sourceLine" id="cb20-4" title="4">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">dunif</span>(x) <span class="co"># usando U(0,1)</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="co">## 1. Amostragem</span></a>
<a class="sourceLine" id="cb20-6" title="6">m &lt;-<span class="st"> </span><span class="fl">1e5</span></a>
<a class="sourceLine" id="cb20-7" title="7">x &lt;-<span class="st"> </span><span class="kw">runif</span>(m)</a>
<a class="sourceLine" id="cb20-8" title="8"><span class="co">## 2. Calcula pesos</span></a>
<a class="sourceLine" id="cb20-9" title="9">w &lt;-<span class="st"> </span><span class="kw">g</span>(x, a, b)<span class="op">/</span><span class="kw">f</span>(x)</a>
<a class="sourceLine" id="cb20-10" title="10">w.norm &lt;-<span class="st"> </span>w<span class="op">/</span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb20-11" title="11"><span class="co">## 3. Re-amostragem por importância</span></a>
<a class="sourceLine" id="cb20-12" title="12">k &lt;-<span class="st"> </span><span class="fl">1e4</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="co">## Amostra considerando os pesos normalizados para cada X</span></a>
<a class="sourceLine" id="cb20-14" title="14">g.sample &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dt">size =</span> k, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> w.norm)</a>
<a class="sourceLine" id="cb20-15" title="15"><span class="co">## Verifica a distribuição da amostra</span></a>
<a class="sourceLine" id="cb20-16" title="16"><span class="kw">hist</span>(g.sample, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb20-17" title="17"><span class="kw">curve</span>(<span class="kw">dbeta</span>(x, a, b), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-22-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Novamente podemos conferir a relação entre os valores amostrados de <span class="math inline">\(X\)</span> e seus respectivos pesos calculados:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">plot</span>(x, w.norm)</a></code></pre></div>
<p><img src="figures/07_MC_aprox/unnamed-chunk-23-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Calcula probabilidades:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co">## P[0.3 &lt; X &lt; 0.5]</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">sum</span>(g.sample <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.3</span> <span class="op">&amp;</span><span class="st"> </span>g.sample <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)<span class="op">/</span>k</a>
<a class="sourceLine" id="cb22-3" title="3"><span class="co"># [1] 0.102</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="kw">pbeta</span>(<span class="fl">0.5</span>, a, b) <span class="op">-</span><span class="st"> </span><span class="kw">pbeta</span>(<span class="fl">0.3</span>, a, b)</a>
<a class="sourceLine" id="cb22-5" title="5"><span class="co"># [1] 0.1018369</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="co">## P[X &gt; 0.2]</span></a>
<a class="sourceLine" id="cb22-7" title="7"><span class="kw">sum</span>(g.sample <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span>)<span class="op">/</span>k</a>
<a class="sourceLine" id="cb22-8" title="8"><span class="co"># [1] 0.584</span></a>
<a class="sourceLine" id="cb22-9" title="9"><span class="kw">pbeta</span>(<span class="fl">0.2</span>, a, b, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb22-10" title="10"><span class="co"># [1] 0.5876479</span></a></code></pre></div>
<p>A obtenção de uma amostra da distribuição completa da VA de interesse possui diversas finalidades. Por exemplo, no caso da beta, podemos obter um resumo</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">summary</span>(g.sample)</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="co"># 0.03969 0.17313 0.21344 0.21780 0.25754 0.50699</span></a></code></pre></div>
<p>ou, por exemplo, saber o intervalo onde se encontram 95% dos dados:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">quantile</span>(g.sample, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>))</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="co">#      2.5%     97.5% </span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="co"># 0.1094833 0.3526790</span></a></code></pre></div>
<p>Esse tipo de resumo será utilizado nos métodos de inferência que veremos mais adiante.</p>
<p>No contexto de inferência bayesiana, as distribuições geradas por estes métodos se referem às <strong>distribuições posteriores dos parâmetros</strong> objetos da inferência. Dessa forma, o intervalo acima, por exemplo, nos forneceria diretamente um “intervalo de credibilidade” de 95% para os valores do parâmetro.</p>
</div>
</div>
</div>

<center>
  <hr width="100%" size="3px">
  <p> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.pt_BR">
      <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" alt="Licença Creative Commons 4.0"> </a>
  </p>
  <p> <font size="2"> Este conteúdo
      está disponível por meio da Licença Creative Commons 4.0 </font>
  </p>
</center>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
